<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <title>多态一对一 | Laravel 学习记录</title><meta name="description" content="Laravel学习点滴"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="VuePress 2.0.0-beta.4">
    <link rel="preload" href="/laravel-study/assets/js/runtime~app.29d23498.js" as="script"><link rel="preload" href="/laravel-study/assets/css/styles.9ef2d71a.css" as="style"><link rel="preload" href="/laravel-study/assets/js/3070.89721d41.js" as="script"><link rel="preload" href="/laravel-study/assets/js/app.c23d06b3.js" as="script">
    <link rel="stylesheet" href="/laravel-study/assets/css/styles.9ef2d71a.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button"><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class=""></path></svg></div><span><a href="/laravel-study/" class=""><img class="logo" src="/laravel-study//images/laravel-logo.min.svg" alt="Laravel 学习记录"><span class="site-name can-hide">Laravel 学习记录</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/laravel-study/" class="nav-link" exact="true" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="集合"><span class="title">集合</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="集合"><span class="title">集合</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/laravel-study/collections/" class="nav-link" exact="false" aria-label="基础"><!--[--><!--]--> 基础 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/laravel-study/collections/demo/" class="nav-link" exact="false" aria-label="实际应用"><!--[--><!--]--> 实际应用 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="模型"><span class="title">模型</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="模型"><span class="title">模型</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/laravel-study/model/" class="nav-link" exact="false" aria-label="Laravel模型"><!--[--><!--]--> Laravel模型 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/laravel-study/model/related-relationships/" class="nav-link" exact="false" aria-label="模型关联关系"><!--[--><!--]--> 模型关联关系 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="其它"><span class="title">其它</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="其它"><span class="title">其它</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/laravel-study/tests/" class="nav-link" exact="false" aria-label="测试"><!--[--><!--]--> 测试 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/laravel-study/others/" class="nav-link" exact="false" aria-label="其它"><!--[--><!--]--> 其它 <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><!----></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/laravel-study/" class="nav-link" exact="true" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="集合"><span class="title">集合</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="集合"><span class="title">集合</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/laravel-study/collections/" class="nav-link" exact="false" aria-label="基础"><!--[--><!--]--> 基础 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/laravel-study/collections/demo/" class="nav-link" exact="false" aria-label="实际应用"><!--[--><!--]--> 实际应用 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="模型"><span class="title">模型</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="模型"><span class="title">模型</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/laravel-study/model/" class="nav-link" exact="false" aria-label="Laravel模型"><!--[--><!--]--> Laravel模型 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/laravel-study/model/related-relationships/" class="nav-link" exact="false" aria-label="模型关联关系"><!--[--><!--]--> 模型关联关系 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="其它"><span class="title">其它</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="其它"><span class="title">其它</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/laravel-study/tests/" class="nav-link" exact="false" aria-label="测试"><!--[--><!--]--> 测试 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/laravel-study/others/" class="nav-link" exact="false" aria-label="其它"><!--[--><!--]--> 其它 <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><section class="sidebar-group"><p class="sidebar-heading">基础</p><ul class=""><li><!--[--><a href="/laravel-study/model/laravel-model-caching.html" class="nav-link sidebar-link" exact="false" aria-label="模型缓存"><!--[--><!--]--> 模型缓存 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/laravel-study/model/laravel-model-events.html" class="nav-link sidebar-link" exact="false" aria-label="模型事件"><!--[--><!--]--> 模型事件 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/laravel-study/model/laravel-model-observers.html" class="nav-link sidebar-link" exact="false" aria-label="模型观察者"><!--[--><!--]--> 模型观察者 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/laravel-study/model/some-tips-for-optimize-database-queries.html" class="nav-link sidebar-link" exact="false" aria-label="数据库优化建议"><!--[--><!--]--> 数据库优化建议 <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--><!--[--><section class="sidebar-group"><p class="sidebar-heading">关联关系</p><ul class=""><li><!--[--><a href="/laravel-study/model/related-relationships/belongsToMany.html" class="nav-link sidebar-link" exact="false" aria-label="多对多"><!--[--><!--]--> 多对多 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/laravel-study/model/related-relationships/hasMany.html" class="nav-link sidebar-link" exact="false" aria-label="一对多"><!--[--><!--]--> 一对多 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/laravel-study/model/related-relationships/hasManyThrough.html" class="nav-link sidebar-link" exact="false" aria-label="远层一对多"><!--[--><!--]--> 远层一对多 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/laravel-study/model/related-relationships/hasOne.html" class="nav-link sidebar-link" exact="false" aria-label="一对一"><!--[--><!--]--> 一对一 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/laravel-study/model/related-relationships/hasOneThrough.html" class="nav-link sidebar-link" exact="false" aria-label="远层一对一"><!--[--><!--]--> 远层一对一 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/laravel-study/model/related-relationships/morphMany.html" class="nav-link sidebar-link" exact="false" aria-label="多态关联"><!--[--><!--]--> 多态关联 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/laravel-study/model/related-relationships/morphOne.html" class="router-link-active router-link-exact-active nav-link sidebar-link active" exact="false" aria-label="多态一对一"><!--[--><!--]--> 多态一对一 <!--[--><!--]--></a><ul class="sidebar-sub-headers"><li><!--[--><a aria-current="page" href="/laravel-study/model/related-relationships/morphOne.html#软件版本" class="router-link-active router-link-exact-active nav-link sidebar-link" exact="false" aria-label="软件版本"><!--[--><!--]--> 软件版本 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/laravel-study/model/related-relationships/morphOne.html#表结构" class="router-link-active router-link-exact-active nav-link sidebar-link" exact="false" aria-label="表结构"><!--[--><!--]--> 表结构 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/laravel-study/model/related-relationships/morphOne.html#关键字" class="router-link-active router-link-exact-active nav-link sidebar-link" exact="false" aria-label="关键字"><!--[--><!--]--> 关键字 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/laravel-study/model/related-relationships/morphOne.html#定义-eloquent-关联关系" class="router-link-active router-link-exact-active nav-link sidebar-link" exact="false" aria-label="定义 Eloquent 关联关系"><!--[--><!--]--> 定义 Eloquent 关联关系 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/laravel-study/model/related-relationships/morphOne.html#关联操作" class="router-link-active router-link-exact-active nav-link sidebar-link" exact="false" aria-label="关联操作"><!--[--><!--]--> 关联操作 <!--[--><!--]--></a><ul class="sidebar-sub-headers"><li><!--[--><a aria-current="page" href="/laravel-study/model/related-relationships/morphOne.html#新增关联数据" class="router-link-active router-link-exact-active nav-link sidebar-link" exact="false" aria-label="新增关联数据"><!--[--><!--]--> 新增关联数据 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/laravel-study/model/related-relationships/morphOne.html#查询关联数据" class="router-link-active router-link-exact-active nav-link sidebar-link" exact="false" aria-label="查询关联数据"><!--[--><!--]--> 查询关联数据 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/laravel-study/model/related-relationships/morphOne.html#更新关联数据" class="router-link-active router-link-exact-active nav-link sidebar-link" exact="false" aria-label="更新关联数据"><!--[--><!--]--> 更新关联数据 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/laravel-study/model/related-relationships/morphOne.html#删除关联数据" class="router-link-active router-link-exact-active nav-link sidebar-link" exact="false" aria-label="删除关联数据"><!--[--><!--]--> 删除关联数据 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--></li><li><!--[--><a href="/laravel-study/model/related-relationships/morphToMany.html" class="nav-link sidebar-link" exact="false" aria-label="多对多多态关联"><!--[--><!--]--> 多对多多态关联 <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--><!--]--></ul><!--[--><!--]--></aside><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="多态一对一"><a class="header-anchor" href="#多态一对一">#</a> 多态一对一</h1><p>一对一的多态关联和简单的一对一关联类似，不同之处在于目标模型在单个关联下可以归属于多种不同的模型。</p><p>例如，<code>Post</code> 和 <code>User</code> 可以共享与 <code>Image</code> 模型的多态关联。</p><p>使用一对一多态关联，可以拥有一个可用于博客文章和用户账户的唯一图片列表。</p><h2 id="软件版本"><a class="header-anchor" href="#软件版本">#</a> 软件版本</h2><ul><li><p>Laravel Version 5.4.19</p></li><li><p>PHP Version 7.0.8</p></li></ul><h2 id="表结构"><a class="header-anchor" href="#表结构">#</a> 表结构</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>posts
    id - integer
    name - string

users
    id - integer
    name - string

images
    id - integer
    url - string
    imageable_id - integer
    imageable_type - string
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>注意 <code>images</code> 表中的 <code>imageable_id</code> 和 <code>imageable_type</code> 字段，<code>imageable_id</code> 字段存储的是文章或用户的 ID 值，而 <code>imageable_type</code> 字段存储的是归属父模型的类名。</p><p>访问 <code>imageable</code> 关联时，<code>Eloquent</code> 使用 <code>imageable_type</code> 字段来判定返回哪种类型的父模型（<code>Post</code> 还是 <code>User</code>）。</p><h2 id="关键字"><a class="header-anchor" href="#关键字">#</a> 关键字</h2><ul><li><p><code>morphTo()</code></p></li><li><p><code>morphOne()</code></p></li></ul><h2 id="定义-eloquent-关联关系"><a class="header-anchor" href="#定义-eloquent-关联关系">#</a> 定义 Eloquent 关联关系</h2><ul><li>在 <code>Image</code> 模型中定义关联关系</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;?php

namespace App;

use Illuminate\Database\Eloquent\Model;

class Image extends Model
{
    /**
     * Get all of the owning imageable models.
     */
    public function imageable()
    {
        return $this-&gt;morphTo();
    }
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>在 <code>Post</code> 模型中定义一对一关联关系</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;?php

class Post extends Model
{
    /**
     * Get the post&#39;s image.
     */
    public function image()
    {
        return $this-&gt;morphOne(&#39;App\Image&#39;, &#39;imageable&#39;);
    }
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>在 <code>User</code> 模型中定义一对一关联关系</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;?php

class User extends Model
{
    /**
     * Get the user&#39;s image.
     */
    public function image()
    {
        return $this-&gt;morphOne(&#39;App\Image&#39;, &#39;imageable&#39;);
    }
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="关联操作"><a class="header-anchor" href="#关联操作">#</a> 关联操作</h2><h3 id="新增关联数据"><a class="header-anchor" href="#新增关联数据">#</a> 新增关联数据</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$user-&gt;image()-&gt;save($image); // 执行关联写入操作

$post-&gt;image()-&gt;save($image);
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="查询关联数据"><a class="header-anchor" href="#查询关联数据">#</a> 查询关联数据</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$post = App\Post::find(1);
$user = App\User::first();

$user-&gt;image;
$image = $post-&gt;image; // 通过 image 动态属性获取关联数据
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>还可以从多态模型中通过访问调用 <code>morphTo</code> 的方法名来获取其归属的父模型。在这个例子中，就是 <code>Image</code> 模型的 <code>imageable</code> 方法。</p><p>因此，我们可以通过动态属性的方式来访问该方法</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$image = App\Image::find(1);

$imageable = $image-&gt;imageable;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p><code>Image</code> 模型上的 <code>imageable</code> 关联将会返回 <code>Post</code> 或 <code>User</code> 实例，这取决于哪中模型拥有该图片。</p></blockquote><h3 id="更新关联数据"><a class="header-anchor" href="#更新关联数据">#</a> 更新关联数据</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$user = \App\User::first();
$image = $user-&gt;image; // 获取到关联信息
$image-&gt;url = &#39;new url&#39;;
$image-&gt;save();

// 或者使用链式调用
\App\User::first()-&gt;image()-&gt;save([&#39;url&#39; =&gt; &#39;new url&#39;]);
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="删除关联数据"><a class="header-anchor" href="#删除关联数据">#</a> 删除关联数据</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$user = \App\User::first();
$user-&gt;image-&gt;delete(); // 删除用户 users 表和 images 相关记录
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">3/31/2021, 5:22:43 AM</span></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/laravel-study/model/related-relationships/morphMany.html" class="nav-link" exact="false" aria-label="多态关联"><!--[--><!--]--> 多态关联 <!--[--><!--]--></a></span><span class="next"><a href="/laravel-study/model/related-relationships/morphToMany.html" class="nav-link" exact="false" aria-label="多对多多态关联"><!--[--><!--]--> 多对多多态关联 <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main></div><!----><!--]--></div>
    <script src="/laravel-study/assets/js/runtime~app.29d23498.js" defer></script><script src="/laravel-study/assets/js/3070.89721d41.js" defer></script><script src="/laravel-study/assets/js/app.c23d06b3.js" defer></script>
  </body>
</html>
