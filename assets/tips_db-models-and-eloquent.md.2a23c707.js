import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.e8ee2c8f.js";const h=JSON.parse('{"title":"DB æ¨¡å‹å’Œ Eloquent","description":"","frontmatter":{},"headers":[],"relativePath":"tips/db-models-and-eloquent.md","filePath":"tips/db-models-and-eloquent.md","lastUpdated":1697513358000}'),p={name:"tips/db-models-and-eloquent.md"},o=l(`<h1 id="db-æ¨¡å‹å’Œ-eloquent" tabindex="-1">DB æ¨¡å‹å’Œ Eloquent <a class="header-anchor" href="#db-æ¨¡å‹å’Œ-eloquent" aria-label="Permalink to &quot;DB æ¨¡å‹å’Œ Eloquent&quot;">â€‹</a></h1><h2 id="orderbyraw-åŸå§‹æŸ¥è¯¢æ’åº" tabindex="-1">orderByRaw åŸå§‹æŸ¥è¯¢æ’åº <a class="header-anchor" href="#orderbyraw-åŸå§‹æŸ¥è¯¢æ’åº" aria-label="Permalink to &quot;orderByRaw åŸå§‹æŸ¥è¯¢æ’åº&quot;">â€‹</a></h2><p>å¯ä»¥ä¼ é€’åŸå§‹æŸ¥è¯¢æ¥å¯¹ç»“æœè¿›è¡Œæ’åºã€‚ ä¾‹å¦‚ï¼ŒæŒ‰ç…§ä»»åŠ¡åœ¨æˆªæ­¢æ—¥æœŸä¹‹å‰å®Œæˆçš„æ—¶é—´å¯¹ä»»åŠ¡è¿›è¡Œæ’åºã€‚</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// æŒ‰ä»»åŠ¡åœ¨æˆªæ­¢æ—¥æœŸä¹‹å‰å®Œæˆå¯¹ä»»åŠ¡è¿›è¡Œæ’åº</span></span>
<span class="line"><span style="color:#79B8FF;">Task</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">query</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">whereNotNull</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;completed_at&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">orderByRaw</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;due_at - completed_at DESC&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#6A737D;">// æŒ‰ä»»åŠ¡åœ¨æˆªæ­¢æ—¥æœŸä¹‹å‰å®Œæˆå¯¹ä»»åŠ¡è¿›è¡Œæ’åº</span></span>
<span class="line"><span style="color:#005CC5;">Task</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">query</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">whereNotNull</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;completed_at&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line highlighted"><span style="color:#24292E;">    </span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">orderByRaw</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;due_at - completed_at DESC&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">();</span></span></code></pre></div><h2 id="wherebetween-è·å–ä¸¤ä¸ªæ—¶é—´ä¹‹é—´çš„æ•°æ®" tabindex="-1">ğ˜„ğ—µğ—²ğ—¿ğ—²ğ—•ğ—²ğ˜ğ˜„ğ—²ğ—²ğ—» è·å–ä¸¤ä¸ªæ—¶é—´ä¹‹é—´çš„æ•°æ® <a class="header-anchor" href="#wherebetween-è·å–ä¸¤ä¸ªæ—¶é—´ä¹‹é—´çš„æ•°æ®" aria-label="Permalink to &quot;ğ˜„ğ—µğ—²ğ—¿ğ—²ğ—•ğ—²ğ˜ğ˜„ğ—²ğ—²ğ—» è·å–ä¸¤ä¸ªæ—¶é—´ä¹‹é—´çš„æ•°æ®&quot;">â€‹</a></h2><p>ä½¿ç”¨ <code>ğ˜„ğ—µğ—²ğ—¿ğ—²ğ—•ğ—²ğ˜ğ˜„ğ—²ğ—²ğ—»</code> åŠ è½½ä¸¤ä¸ªæ—¶é—´æˆ³ä¹‹é—´çš„è®°å½•ã€‚</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// åŠ è½½ä¸¤ä¸ªæ—¶é—´æˆ³ä¹‹é—´å®Œæˆçš„ä»»åŠ¡</span></span>
<span class="line"><span style="color:#79B8FF;">Task</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">whereBetween</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;completed_at&#39;</span><span style="color:#E1E4E8;">, [</span></span>
<span class="line"><span style="color:#E1E4E8;">    $request</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">from </span><span style="color:#F97583;">??</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;2023-01-01&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    $request</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">to </span><span style="color:#F97583;">??</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">today</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">toDateTimeString</span><span style="color:#E1E4E8;">(),</span></span>
<span class="line"><span style="color:#E1E4E8;">]);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// åŠ è½½ä¸¤ä¸ªæ—¶é—´æˆ³ä¹‹é—´å®Œæˆçš„ä»»åŠ¡</span></span>
<span class="line"><span style="color:#005CC5;">Task</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">whereBetween</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;completed_at&#39;</span><span style="color:#24292E;">, [</span></span>
<span class="line"><span style="color:#24292E;">    $request</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">from </span><span style="color:#D73A49;">??</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;2023-01-01&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    $request</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">to </span><span style="color:#D73A49;">??</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">today</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">toDateTimeString</span><span style="color:#24292E;">(),</span></span>
<span class="line"><span style="color:#24292E;">]);</span></span></code></pre></div><h2 id="whereintegerinraw" tabindex="-1">whereIntegerInRaw <a class="header-anchor" href="#whereintegerinraw" aria-label="Permalink to &quot;whereIntegerInRaw&quot;">â€‹</a></h2><p>å½“ç›®æ ‡å€¼ä¸º<strong>æ•´å‹</strong>æ—¶ï¼Œä¸è¦ä½¿ç”¨ <code>ğ˜„ğ—µğ—²ğ—¿ğ—²ğ—œğ—»()</code> æ–¹æ³•åŠ è½½å¤§èŒƒå›´æ•°æ®ï¼Œè€Œæ˜¯ä½¿ç”¨ <code>ğ˜„ğ—µğ—²ğ—¿ğ—²ğ—œğ—»ğ˜ğ—²ğ—´ğ—²ğ—¿ğ—œğ—»ğ—¥ğ—®ğ˜„()</code> æ¯” <code>ğ˜„ğ—µğ—²ğ—¿ğ—²ğ—œğ—»()</code> æ›´å¿«ã€‚</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#F97583;">&lt;?</span><span style="color:#79B8FF;">php</span></span>
<span class="line"></span>
<span class="line diff remove"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">Product</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">whereIn</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;id&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">range</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">50</span><span style="color:#E1E4E8;">))</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(); </span></span>
<span class="line diff add"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">Product</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">whereIntegerInRaw</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;id&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">range</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">50</span><span style="color:#E1E4E8;">))</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(); </span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#D73A49;">&lt;?</span><span style="color:#005CC5;">php</span></span>
<span class="line"></span>
<span class="line diff remove"><span style="color:#24292E;">    </span><span style="color:#005CC5;">Product</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">whereIn</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;id&#39;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">range</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">50</span><span style="color:#24292E;">))</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(); </span></span>
<span class="line diff add"><span style="color:#24292E;">    </span><span style="color:#005CC5;">Product</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">whereIntegerInRaw</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;id&#39;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">range</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">50</span><span style="color:#24292E;">))</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(); </span></span></code></pre></div><h2 id="rawvalue" tabindex="-1">rawValue <a class="header-anchor" href="#rawvalue" aria-label="Permalink to &quot;rawValue&quot;">â€‹</a></h2><p>Laravel 9.37 æœ‰ä¸€ä¸ªæ–°çš„ <code>rawValue()</code> æ–¹æ³•æ¥ä» SQL è¡¨è¾¾å¼ä¸­è·å–å€¼ã€‚</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">$first </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">TripModel</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">orderBy</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;date_at&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;ASC&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">rawValue</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;YEAR(\`date_at\`)&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">$last </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">TripModel</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">orderBy</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;date_at&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;DESC&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">rawValue</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;YEAR(\`date_at\`)&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">$fullname </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">UserModel</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">where</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;id&#39;</span><span style="color:#E1E4E8;">, $id)</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">rawValue</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;CONCAT(\`first_name\`, &quot; &quot;, \`last_name\`)&#39;</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">$first </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">TripModel</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">orderBy</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;date_at&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;ASC&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">rawValue</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;YEAR(\`date_at\`)&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">$last </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">TripModel</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">orderBy</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;date_at&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;DESC&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">rawValue</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;YEAR(\`date_at\`)&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">$fullname </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">UserModel</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">where</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;id&#39;</span><span style="color:#24292E;">, $id)</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">rawValue</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;CONCAT(\`first_name\`, &quot; &quot;, \`last_name\`)&#39;</span><span style="color:#24292E;">);</span></span></code></pre></div><h2 id="scope-å…¶ä»–å…³ç³»çš„æ¨¡å‹èŒƒå›´" tabindex="-1">scope å…¶ä»–å…³ç³»çš„æ¨¡å‹èŒƒå›´ <a class="header-anchor" href="#scope-å…¶ä»–å…³ç³»çš„æ¨¡å‹èŒƒå›´" aria-label="Permalink to &quot;scope å…¶ä»–å…³ç³»çš„æ¨¡å‹èŒƒå›´&quot;">â€‹</a></h2><p>å¯ä»¥ä½¿ç”¨æ¨¡å‹èŒƒå›´æ¥å®šä¹‰ä¸€ä¸ªç›¸å…³çš„æ¨¡å‹å…³è”å…³ç³»ã€‚</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-iju4Q" id="tab-qVvi31p" checked="checked"><label for="tab-qVvi31p">app/Models/Course.php</label><input type="radio" name="group-iju4Q" id="tab--XcrNLX"><label for="tab--XcrNLX">app/Models/Lesson.php</label></div><div class="blocks"><div class="language-php vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">lessons</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">HasMany</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">$this</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">hasMany</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">Lesson</span><span style="color:#F97583;">::class</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">publishedLessons</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">HasMany</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">$this</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">lessons</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">published</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">lessons</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">HasMany</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">$this</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">hasMany</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">Lesson</span><span style="color:#D73A49;">::class</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">publishedLessons</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">HasMany</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line highlighted"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">$this</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">lessons</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">published</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">scopePublished</span><span style="color:#E1E4E8;">($query)</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> $query</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">where</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;is_published&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">scopePublished</span><span style="color:#24292E;">($query)</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> $query</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">where</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;is_published&#39;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div></div></div><h2 id="db-aftercommit-äº‹åŠ¡å¤„ç†" tabindex="-1">DB::afterCommit äº‹åŠ¡å¤„ç† <a class="header-anchor" href="#db-aftercommit-äº‹åŠ¡å¤„ç†" aria-label="Permalink to &quot;DB::afterCommit äº‹åŠ¡å¤„ç†&quot;">â€‹</a></h2><p>ä½¿ç”¨ <code>DB::afterCommit()</code> æ–¹æ³•ï¼Œå¯ä»¥ç¼–å†™ä»…åœ¨äº‹åŠ¡æäº¤æ—¶æ‰§è¡Œçš„ä»£ç ï¼Œä»¥åŠåœ¨äº‹åŠ¡å›æ»šæ—¶ä¸¢å¼ƒçš„ä»£ç ã€‚</p><p>å¦‚æœæ²¡æœ‰äº‹åŠ¡æ—¶ï¼Œä»£ç ä¼šç«‹å³æ‰§è¡Œã€‚</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-857zh" id="tab-Gci7XaW" checked="checked"><label for="tab-Gci7XaW">æ¨¡å‹é€»è¾‘</label><input type="radio" name="group-857zh" id="tab-_9a_U0G"><label for="tab-_9a_U0G">ä¸šåŠ¡é€»è¾‘</label></div><div class="blocks"><div class="language-php vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">User</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Model</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">protected</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">booted</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">static::</span><span style="color:#B392F0;">created</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">self</span><span style="color:#E1E4E8;"> $user) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// ä»…å½“æ»¡è¶³äº‹åŠ¡å·²æäº¤æ¡ä»¶æ—¶æ‰ä¼šå‘é€ç”µå­é‚®ä»¶</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">DB</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">afterCommit</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">use</span><span style="color:#E1E4E8;"> ($user) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#79B8FF;">Mail</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">send</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">WelcomeEmail</span><span style="color:#E1E4E8;">($user));</span></span>
<span class="line"><span style="color:#E1E4E8;">            });</span></span>
<span class="line"><span style="color:#E1E4E8;">        });</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">User</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Model</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">protected</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">booted</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">static::</span><span style="color:#6F42C1;">created</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">self</span><span style="color:#24292E;"> $user) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// ä»…å½“æ»¡è¶³äº‹åŠ¡å·²æäº¤æ¡ä»¶æ—¶æ‰ä¼šå‘é€ç”µå­é‚®ä»¶</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">DB</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">afterCommit</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> () </span><span style="color:#D73A49;">use</span><span style="color:#24292E;"> ($user) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#005CC5;">Mail</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">send</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">WelcomeEmail</span><span style="color:#24292E;">($user));</span></span>
<span class="line"><span style="color:#24292E;">            });</span></span>
<span class="line"><span style="color:#24292E;">        });</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">DB</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">transaction</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> () {</span></span>
<span class="line"><span style="color:#E1E4E8;">    $user </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">User</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">([</span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">]);</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">    $user</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">teams</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">([</span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">]);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">DB</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">transaction</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> () {</span></span>
<span class="line"><span style="color:#24292E;">    $user </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">User</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">([</span><span style="color:#D73A49;">...</span><span style="color:#24292E;">]);</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">    $user</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">teams</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">([</span><span style="color:#D73A49;">...</span><span style="color:#24292E;">]);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div></div></div><h2 id="withouttimestamps-æ‰§è¡Œæ“ä½œæ—¶ä¸ä¿®æ”¹-updated-at-å­—æ®µ" tabindex="-1"><code>withoutTimestamps</code> æ‰§è¡Œæ“ä½œæ—¶ä¸ä¿®æ”¹ <code>updated_at</code> å­—æ®µ <a class="header-anchor" href="#withouttimestamps-æ‰§è¡Œæ“ä½œæ—¶ä¸ä¿®æ”¹-updated-at-å­—æ®µ" aria-label="Permalink to &quot;\`withoutTimestamps\` æ‰§è¡Œæ“ä½œæ—¶ä¸ä¿®æ”¹ \`updated_at\` å­—æ®µ&quot;">â€‹</a></h2><p>ä» Laravel 9.31 å¼€å§‹å¯ç”¨ï¼Œå¦‚æœæƒ³åœ¨æ‰§è¡Œæ¨¡å‹æ“ä½œçš„æƒ…å†µä¸‹è®©æ¨¡å‹çš„ <code>Updated_at</code> æ—¶é—´æˆ³ä¸è¢«ä¿®æ”¹ï¼Œå¯ä»¥åœ¨ç»™å®šçš„æ¨¡å‹æ–¹æ³• <code>withoutTimestamps</code> çš„é—­åŒ…å†…å¯¹æ¨¡å‹è¿›è¡Œæ“ä½œã€‚</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">$user </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">User</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">query</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">first</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// \`updated_at\` å­—æ®µå°†ä¸ä¼šå˜æ›´</span></span>
<span class="line"><span style="color:#79B8FF;">User</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">withoutTimestamps</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">fn</span><span style="color:#E1E4E8;"> () =&gt; $user</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">update</span><span style="color:#E1E4E8;">([</span><span style="color:#9ECBFF;">&#39;reserved_at&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">now</span><span style="color:#E1E4E8;">()])</span></span>
<span class="line"><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">$user </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">User</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">query</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">first</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// \`updated_at\` å­—æ®µå°†ä¸ä¼šå˜æ›´</span></span>
<span class="line"><span style="color:#005CC5;">User</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">withoutTimestamps</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#D73A49;">fn</span><span style="color:#24292E;"> () =&gt; $user</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">update</span><span style="color:#24292E;">([</span><span style="color:#032F62;">&#39;reserved_at&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">now</span><span style="color:#24292E;">()])</span></span>
<span class="line"><span style="color:#24292E;">);</span></span></code></pre></div><h2 id="tobase-åˆå¹¶é›†åˆ" tabindex="-1">toBase() åˆå¹¶é›†åˆ <a class="header-anchor" href="#tobase-åˆå¹¶é›†åˆ" aria-label="Permalink to &quot;toBase() åˆå¹¶é›†åˆ&quot;">â€‹</a></h2><p>Eloquent é›†åˆçš„ <code>merge</code> æ–¹æ³•ä½¿ç”¨ <code>id</code> æ¥é¿å…é‡å¤çš„æ¨¡å‹ã€‚</p><p>ä½†å¦‚æœåˆå¹¶ä¸åŒæ¨¡å‹çš„é›†åˆï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚</p><p>å»ºè®®æ”¹ç”¨ <code>toBase()</code> æ–¹æ³•ã€‚</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">$videos </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Video</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">all</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">$images </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Image</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">all</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// å¦‚æœå­˜åœ¨ä¸å›¾åƒå…·æœ‰ç›¸åŒ ID çš„è§†é¢‘ï¼Œå®ƒä»¬å°†è¢«æ›¿æ¢ï¼Œæœ€ç»ˆä¼šä¸¢å¤±è§†é¢‘</span></span>
<span class="line"><span style="color:#E1E4E8;">$allMedia </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> $videos</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">merge</span><span style="color:#E1E4E8;">($images);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// åœ¨ Eloquent é›†åˆä¸­è°ƒç”¨ \`toBase()\` ä»¥ä½¿ç”¨åŸºæœ¬åˆå¹¶æ–¹æ³•</span></span>
<span class="line"><span style="color:#E1E4E8;">$allMedia </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> $videos</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">toBase</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">merge</span><span style="color:#E1E4E8;">($images);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">$videos </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Video</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">all</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">$images </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Image</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">all</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// å¦‚æœå­˜åœ¨ä¸å›¾åƒå…·æœ‰ç›¸åŒ ID çš„è§†é¢‘ï¼Œå®ƒä»¬å°†è¢«æ›¿æ¢ï¼Œæœ€ç»ˆä¼šä¸¢å¤±è§†é¢‘</span></span>
<span class="line"><span style="color:#24292E;">$allMedia </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> $videos</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">merge</span><span style="color:#24292E;">($images);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// åœ¨ Eloquent é›†åˆä¸­è°ƒç”¨ \`toBase()\` ä»¥ä½¿ç”¨åŸºæœ¬åˆå¹¶æ–¹æ³•</span></span>
<span class="line"><span style="color:#24292E;">$allMedia </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> $videos</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">toBase</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">merge</span><span style="color:#24292E;">($images);</span></span></code></pre></div>`,28),e=[o];function t(c,r,y,E,i,d){return a(),n("div",null,e)}const u=s(p,[["render",t]]);export{h as __pageData,u as default};
