<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <title>Laravel 学习记录</title><meta name="description" content="Laravel学习点滴"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="VuePress 2.0.0-beta.4">
    <link rel="preload" href="/assets/js/runtime~app.f0858e2c.js" as="script"><link rel="preload" href="/assets/css/styles.9ef2d71a.css" as="style"><link rel="preload" href="/assets/js/3070.7fcc83c6.js" as="script"><link rel="preload" href="/assets/js/app.564a1c2a.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.9ef2d71a.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><header class="navbar"><div class="toggle-sidebar-button"><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class=""></path></svg></div><span><a href="/" class=""><img class="logo" src="/images/laravel-logo.min.svg" alt="Laravel 学习记录"><span class="site-name can-hide">Laravel 学习记录</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" exact="true" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="集合"><span class="title">集合</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="集合"><span class="title">集合</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/collections/" class="nav-link" exact="false" aria-label="基础"><!--[--><!--]--> 基础 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/collections/demo/" class="nav-link" exact="false" aria-label="实际应用"><!--[--><!--]--> 实际应用 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="模型"><span class="title">模型</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="模型"><span class="title">模型</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/model/" class="nav-link" exact="false" aria-label="Laravel模型"><!--[--><!--]--> Laravel模型 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/model/related-relationships/" class="nav-link" exact="false" aria-label="模型关联关系"><!--[--><!--]--> 模型关联关系 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><a href="/others/" class="nav-link" exact="false" aria-label="其它"><!--[--><!--]--> 其它 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><!----></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" exact="true" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="集合"><span class="title">集合</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="集合"><span class="title">集合</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/collections/" class="nav-link" exact="false" aria-label="基础"><!--[--><!--]--> 基础 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/collections/demo/" class="nav-link" exact="false" aria-label="实际应用"><!--[--><!--]--> 实际应用 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="模型"><span class="title">模型</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="模型"><span class="title">模型</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/model/" class="nav-link" exact="false" aria-label="Laravel模型"><!--[--><!--]--> Laravel模型 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/model/related-relationships/" class="nav-link" exact="false" aria-label="模型关联关系"><!--[--><!--]--> 模型关联关系 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><a href="/others/" class="nav-link" exact="false" aria-label="其它"><!--[--><!--]--> 其它 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--]--></ul><!--[--><!--]--></aside><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h2 id="laravel-5-执行迁移文件报错-specified-key-was-too-long-error"><a class="header-anchor" href="#laravel-5-执行迁移文件报错-specified-key-was-too-long-error">#</a> Laravel 5.* 执行迁移文件报错：Specified key was too long error</h2><p>命令行执行迁移文件时，报错 <code>Specified key was too long</code>，如果我们仔细检查错误会发现是唯一索引太长了，报错信息如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Illuminate\Database\QueryException]
SQLSTATE[42000]: Syntax error or access violation: 1071 Specified key was too long;
max key length is 767 bytes (SQL: alter table `users` add unique `users_email_uniq
ue`(`email`))



[PDOException]
SQLSTATE[42000]: Syntax error or access violation: 1071 Specified key was too long;
max key length is 767 bytes
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>我们当然可以通过修改迁移文件来修改字段的长度，也可以通过修改迁移文件来解决这个问题。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code> $table-&gt;string(&#39;email&#39;,30)-&gt;unique();
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>也可以使用更加通用的办法来完成。编辑 <code>AppServiceProvider.php</code> 文件的 <code>boot()</code> 方法。如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>use Illuminate\Support\Facades\Schema;

public function boot()
{
    Schema::defaultStringLength(191);
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>相当于给予<code>varchar</code>默认的长度<strong>191</strong>。</p><p>修改数据库的字符集 如图，新版的Laravel 5.4 使用了 <code>utf8mb4</code> 和 <code>utf8mb4_unicode_ci</code> ，这个字符集支持 <strong>emoji</strong></p><p><img src="/related_relationship/screenshot_1493026376620.png" alt=""></p><p>我们将他改成：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&#39;charset&#39; =&gt; &#39;utf8&#39;,
&#39;collation&#39; =&gt; &#39;utf8_general_ci&#39;,
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>建议在数据库迁移文件中使用第二个参数根据业务需求指定字段的长度，这样更加的切合实际和需求。</p></blockquote><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">3/30/2021, 2:29:23 AM</span></div><!----></footer><!----><!--[--><!--]--></main></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.f0858e2c.js" defer></script><script src="/assets/js/3070.7fcc83c6.js" defer></script><script src="/assets/js/app.564a1c2a.js" defer></script>
  </body>
</html>
