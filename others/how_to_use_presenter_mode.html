<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <title>Laravel 学习记录</title><meta name="description" content="Laravel学习点滴"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="VuePress 2.0.0-beta.4">
    <link rel="preload" href="/laravel-study/assets/js/runtime~app.05435c8d.js" as="script"><link rel="preload" href="/laravel-study/assets/css/styles.9ef2d71a.css" as="style"><link rel="preload" href="/laravel-study/assets/js/3070.89721d41.js" as="script"><link rel="preload" href="/laravel-study/assets/js/app.f1778539.js" as="script">
    <link rel="stylesheet" href="/laravel-study/assets/css/styles.9ef2d71a.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><header class="navbar"><div class="toggle-sidebar-button"><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class=""></path></svg></div><span><a href="/laravel-study/" class=""><img class="logo" src="/laravel-study//images/laravel-logo.min.svg" alt="Laravel 学习记录"><span class="site-name can-hide">Laravel 学习记录</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/laravel-study/" class="nav-link" exact="true" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="集合"><span class="title">集合</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="集合"><span class="title">集合</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/laravel-study/collections/" class="nav-link" exact="false" aria-label="基础"><!--[--><!--]--> 基础 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/laravel-study/collections/demo/" class="nav-link" exact="false" aria-label="实际应用"><!--[--><!--]--> 实际应用 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="模型"><span class="title">模型</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="模型"><span class="title">模型</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/laravel-study/model/" class="nav-link" exact="false" aria-label="Laravel模型"><!--[--><!--]--> Laravel模型 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/laravel-study/model/related-relationships/" class="nav-link" exact="false" aria-label="模型关联关系"><!--[--><!--]--> 模型关联关系 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="其它"><span class="title">其它</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="其它"><span class="title">其它</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/laravel-study/tests/" class="nav-link" exact="false" aria-label="测试"><!--[--><!--]--> 测试 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/laravel-study/others/" class="nav-link" exact="false" aria-label="其它"><!--[--><!--]--> 其它 <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><!----></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/laravel-study/" class="nav-link" exact="true" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="集合"><span class="title">集合</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="集合"><span class="title">集合</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/laravel-study/collections/" class="nav-link" exact="false" aria-label="基础"><!--[--><!--]--> 基础 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/laravel-study/collections/demo/" class="nav-link" exact="false" aria-label="实际应用"><!--[--><!--]--> 实际应用 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="模型"><span class="title">模型</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="模型"><span class="title">模型</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/laravel-study/model/" class="nav-link" exact="false" aria-label="Laravel模型"><!--[--><!--]--> Laravel模型 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/laravel-study/model/related-relationships/" class="nav-link" exact="false" aria-label="模型关联关系"><!--[--><!--]--> 模型关联关系 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="其它"><span class="title">其它</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="其它"><span class="title">其它</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/laravel-study/tests/" class="nav-link" exact="false" aria-label="测试"><!--[--><!--]--> 测试 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/laravel-study/others/" class="nav-link" exact="false" aria-label="其它"><!--[--><!--]--> 其它 <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--]--></ul><!--[--><!--]--></aside><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h2 id="如何使用presenter模式"><a class="header-anchor" href="#如何使用presenter模式">#</a> 如何使用Presenter模式</h2><p>若将显示逻辑都写在 View，会造成 View 代码臃肿而难以维护，基于 SOLID 原则，应该使用 Presenter 模式辅助 View，将相关的显示逻辑封装在不同的 Presenter ，方便中大型项目的维护。</p><h3 id="版本"><a class="header-anchor" href="#版本">#</a> 版本</h3><p>Lararvel 5.4.17</p><h2 id="显示逻辑"><a class="header-anchor" href="#显示逻辑">#</a> 显示逻辑</h2><p>在实际开发中，显示逻辑常见的如下：</p><ul><li><p>将资料显示不同资料： 如 <code>性别字段为 M，就显示 Mr.，若性别字段为 F，就显示 Mrs.</code></p></li><li><p>是否显示某些资料：如 <code>根据字段值是否等于 T，要不要显示改字段</code></p></li><li><p>依需求显示不同格式：如 <code>依不同的语系，显示不同的日期格式</code></p></li></ul><h2 id="presenter"><a class="header-anchor" href="#presenter">#</a> Presenter</h2><h3 id="将资料显示不同资料"><a class="header-anchor" href="#将资料显示不同资料">#</a> 将资料显示不同资料</h3><p>如 <code>性别字段为 M，就显示 Mr.，若性别字段为 F，就显示 Mrs.</code>，我们可能会直接用 blade 写在 view 里，如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;{{ config(&#39;app.locale&#39;) }}&quot;&gt;
&lt;head&gt;
    &lt;title&gt;Users&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&quot;flex-center position-ref full-height&quot;&gt;
    @foreach($users as $user)
        &lt;div&gt;
            &lt;h2&gt;@if($user-&gt;gender == &#39;m&#39;){{ &quot;Mr.&quot; }} @else {{ &quot;Mrs.&quot; }} @endif {{$user-&gt;name}}&lt;/h2&gt;
            &lt;h2&gt;{{ $user-&gt;email }}&lt;/h2&gt;
        &lt;/div&gt;
    @endforeach
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>在中大型项目中，会有几个问题：</p><ul><li><p>由于 Blade 与 Html 夹杂，不太适合写太复杂的代码，只适合做一些简单的 binding ，否则很容易写成传统的 PHP 的意大利面代码</p></li><li><p>无法对显示逻辑做重构与物件导向</p></li></ul><p>比较好的方式是使用 Presenter，具体步骤如下：</p><ul><li><p>将相依无间注入到 Presenter</p></li><li><p>在 presenter 内写格式转换</p></li><li><p>将 Presenter 注入到 View</p></li></ul><h4 id="定义userpresenter"><a class="header-anchor" href="#定义userpresenter">#</a> 定义UserPresenter</h4><p><code>app\Presenters\UserPersenter.php</code> 代码如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;?php

namespace App\Presenters;


/**
 * Class UserPresenter
 *
 * @package App\Presenters
 */
class UserPresenter
{
    /**
     * @param string $gender
     * @param string $name
     *
     * @return string
     */
    public function getFullName($gender, $name)
    {
        return $gender == &#39;M&#39; ? &#39;Mr. &#39; . $name : &#39;Mrs. &#39; . $name;
    }
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>将原本在 blade 中用 <code>@if(){ .. }@else .. @endif</code> 写的逻辑改写在 Presenter 中。</p><h4 id="视图中使用userpresenter"><a class="header-anchor" href="#视图中使用userpresenter">#</a> 视图中使用UserPresenter</h4><p>使用 <code>@inject()</code> 注入 <code>UserPresenter</code>，让 View 可以如 Controller 一样使用注入的物件。</p><p>将来如乱显示逻辑怎么修改，都不用改到 Blade ，直接在相关 Presenter 中修改即可。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;{{ config(&#39;app.locale&#39;) }}&quot;&gt;
&lt;head&gt;
    &lt;title&gt;Users&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&quot;flex-center position-ref full-height&quot;&gt;
    @inject(&#39;userPresenter&#39;,&#39;App\Presenters\UserPresenter&#39;)
    @foreach($users as $user)
        &lt;div&gt;
            {{--&lt;h2&gt;@if($user-&gt;gender == &#39;m&#39;){{ &quot;Mr.&quot; }} @else {{ &quot;Mrs.&quot; }} @endif {{$user-&gt;name}}&lt;/h2&gt;--}}
            &lt;h2&gt;{{ $userPresenter-&gt;getFullName($user-&gt;gender,$user-&gt;name) }}&lt;/h2&gt;
            &lt;h2&gt;{{ $user-&gt;email }}&lt;/h2&gt;
        &lt;/div&gt;
    @endforeach
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>改用这种重写，有几个优点：</p><ul><li><p>将资料显示不同个格式的显示逻辑改写在 presenter，解决了 blade 不容易维护的问题</p></li><li><p>可以显示逻辑做重构于物件导向</p></li></ul><h2 id="是否显示某些资料"><a class="header-anchor" href="#是否显示某些资料">#</a> 是否显示某些资料</h2><p>如 <code>根据字段值是否为 T ，要不要显示该字段</code>，我们常常会直接用 blade 写在 View 中。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;{{ config(&#39;app.locale&#39;) }}&quot;&gt;
&lt;head&gt;
    &lt;title&gt;Users&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&quot;flex-center position-ref full-height&quot;&gt;
    @foreach($users as $user)
        &lt;h2&gt;{{ $user-&gt;name }}&lt;/h2&gt;
        @if($user-&gt;is_hidden == &#39;F&#39;)
            &lt;h2&gt;{{ $user-&gt;email }}&lt;/h2&gt;
        @endif
    @endforeach
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>在中大型项目中，会有几个问题：</p><ul><li><p>由于 blade 与 HTML 夹杂，不太适合写太复杂的业务代码，只适合做一些简单的 binding，否则很容易写成传统的 PHP 的意大利面代码</p></li><li><p>无法对显示逻辑做重构与物件导向</p></li></ul><p>比较好的方式是使用 Presenter，具体步骤如下：</p><ul><li><p>将相依无间注入到 Presenter</p></li><li><p>在 presenter 内写格式转换</p></li><li><p>将 Presenter 注入到 View</p></li></ul><p><code>app\Presenters\UserPresenter.php</code> 代码：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;?php
namespace App\Presenters;

use App\User;
/**
 * Class UserPresenter
 *
 * @package App\Presenters
 */
class UserPresenter
{
    /**
     * @param \App\User $user
     *
     * @return string
     */
    public function showEmail(User $user)
    {
        if ($user-&gt;is_hidden == &#39;F&#39;) {
            return &#39;&lt;h2&gt;&#39; . $user-&gt;email &#39;&lt;/h2&gt;&#39;;
        }
        return &#39;&#39;;
    }
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>将 <code>@if() .. @endif</code> 的 boolean 判断封装在 Presenter 内，改由 Presenter 负责输出 HTML。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;{{ config(&#39;app.locale&#39;) }}&quot;&gt;
&lt;head&gt;
    &lt;title&gt;Users&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&quot;flex-center position-ref full-height&quot;&gt;
    @inject(&#39;userPresenter&#39;,&#39;App\Presenters\UserPresenter&#39;)
    @foreach($users as $user)
        &lt;h2&gt;{{ $user-&gt;name }}&lt;/h2&gt;
        {!! $userPresenter-&gt;showEmail($user) !!}
    @endforeach
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>使用 <code>@inject()</code> 注入 <code>UserPresenter</code>，让 View 也可以如 Controller 一样使用注入的物件。</p><p><code>{!! !!}</code> 会保留原来的 HTML 格式。</p><p>将来无论显示逻辑怎么修改，都不用改到 Blade ，直接在 Presenter 内修改。</p><p>改用这种写法，有几个优点：</p><ul><li><p><code>是否显示某些资料</code> 的显示逻辑改为在 Presenter，解决写在 Blade 不容易维护的问题</p></li><li><p>可对显示逻辑做重构与物件导向</p></li></ul><h3 id="依需求显示不同格式"><a class="header-anchor" href="#依需求显示不同格式">#</a> 依需求显示不同格式</h3><p>如 <code>按照不同的语系，显示不同的日期格式</code>，我们常常会直接用 Blade 写在 View 里。 如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;{{ config(&#39;app.locale&#39;) }}&quot;&gt;
&lt;head&gt;
    &lt;title&gt;Users&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&quot;flex-center position-ref full-height&quot;&gt;
    @foreach($users as $user)
        &lt;div&gt;
            @if(App::getLocale() == &#39;uk&#39;)
                &lt;h2&gt;{{ $user-&gt;created_at-&gt;format(&#39;d M, Y&#39;) }}&lt;/h2&gt;
            @elseif(App::getLocale() == &#39;tw&#39;)
                &lt;h2&gt;{{ $user-&gt;creaetd_at-&gt;format(&#39;Y/m/d&#39;) }}&lt;/h2&gt;
            @else
                &lt;h2&gt;{{ $user-&gt;created_at-&gt;formate(&#39;M d, Y&#39;) }}&lt;/h2&gt;
            @endif
        &lt;/div&gt;
    @endforeach
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>在中大型的醒目中，会有几个问题：</p><ul><li><p>由于 Blade 与 HTML 夹杂，不太适合写太复杂的代码，只适合做一些简单的 binding，否则很容易写成传统的 PHP 的意大利面代码</p></li><li><p>无法对显示逻辑做重构与物件导向</p></li></ul><p>比较好的方式是使用 Presenter，具体步骤如下：</p><ul><li><p>将相依无间注入到 Presenter</p></li><li><p>在 presenter 内写不同的日期格式转换逻辑</p></li><li><p>将 Presenter 注入到 View</p></li></ul><h4 id="定义接口"><a class="header-anchor" href="#定义接口">#</a> 定义接口</h4><p>定义接口代码 <code>app\Presenters\DataFormatPresenterInterface.php</code> ，具体代码如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;?php

namespace App\Presenters;

use Carbon\Carbon;

/**
 * Interface DateFormatPresenterInterface
 *
 * @package App\Presenters
 */
interface DateFormatPresenterInterface
{
    /**
     * 显示日期格式
     *
     * @param \Carbon\Carbon $data
     *
     * @return string
     */
    public function showDateFormat(Carbon $data);
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>定义了 <code>showDateFormat()</code>，各语言必须在 <code>showDateFormat()</code> 使用 Carbon 的 <code>format()</code> 去转换日期格式。</p><h4 id="一些presenter"><a class="header-anchor" href="#一些presenter">#</a> 一些Presenter</h4><p><code>app\Presenters\DateFormatPresenterTW.php</code>，具体代码内容如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;?php

namespace App\Presenters;

use Carbon\Carbon;

/**
 * Class DateFormatPresenterTw
 *
 * @package \App\Presenters
 */
class DateFormatPresenterTw implements DateFormatPresenterInterface
{
    /**
     * @param \Carbon\Carbon $date
     *
     * @return string
     */
    public function showDateFormat(Carbon $date)
    {
        return $date-&gt;format(&#39;Y/m/d&#39;);
    }
}

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><code>app\Presenters\DateFormatPresenterUk.php</code>，具体代码内容如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;?php

namespace App\Presenters;

use Carbon\Carbon;

/**
 * Class DateFormatPresenterUk
 *
 * @package \App\Presenters
 */
class DateFormatPresenterUk implements DateFormatPresenterInterface
{
    /**
     * @param \Carbon\Carbon $data
     *
     * @return string
     */
    public function showDateFormat(Carbon $data)
    {
        return $data-&gt;format(&#39;d M, Y&#39;);
    }
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><code>app\Presenters\DateFormatPresenterUs.php</code>，具体代码内容如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;?php

namespace App\Presenters;

use Carbon\Carbon;

/**
 * Class DateFormatPresenterUs
 *
 * @package \App\Presenters
 */
class DateFormatPresenterUs implements DateFormatPresenterInterface
{
    /**
     * @param \Carbon\Carbon $date
     *
     * @return string
     */
    public function showDateFormat(Carbon $date)
    {
        return $date-&gt;format(&#39;M d,Y&#39;);
    }
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>以上类都实现了 <code>DateFormatPresenterInterface</code> 接口，并将转换成相对应国家日期格式的 Carbon 的 <code>format()</code> 写在 <code>showDateFormat()</code> 内。</p><h4 id="presenter-工厂"><a class="header-anchor" href="#presenter-工厂">#</a> Presenter 工厂</h4><p>由于每个语言的日期格式都是一个 presenter 物件，那势必遇到一个最基本的问题： <code>我们必须根据不同的语言去实例化不同的 Presenter 物件</code>，我们可能会在 Controller 中去 实例化。如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>/**
 * @param \Illuminate\Http\Request $request
 *
 * @return int
 */
public function index(Request $request)
{
    $locate = &#39;hk&#39;;
   switch ($locate){
       case &#39;uk&#39;:
           $presenter = new DateFormatPresenterUk();
           break;
       case &#39;tw&#39;:
           $presenter = new DateFormatPresenterTw();
           break;
       default:
           $presenter = new DateFormatPresenterUs();
   }
   return $presenter;
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>这种写法虽然可行，但是有如下问题：</p><ul><li><p>违反了 SOLID 的开放封闭原则：若将来有新的语言需求，只能不断去修改 <code>index()</code> ，然后不断的新增 <code>elseif()</code> ，计算改用 <code>switch{ .. }</code> 也是一样</p></li><li><p>违反了 SOLID 的依赖反转原则：Controller 直接根据语言去实例化对应的 Class ，高层直接相依于底层，直接将实例化对象写死在代码里</p></li><li><p>无法单元测试：由于 Presenter 直接 New 在 Controller ，因此要测试时，无法对 Presenter 做 mock</p></li></ul><h5 id="定义工厂"><a class="header-anchor" href="#定义工厂">#</a> 定义工厂</h5><p>比较好的解决方式是使用 <strong>Factory Pattern</strong></p><p><code>app/Presenters/DateFormatPresenterFactory.php</code> 内容如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;?php

namespace App\Presenters;

/**
 * Class DateFormatPresenterFactory
 *
 * @package \App\Presenters
 */
class DateFormatPresenterFactory
{
    /**
     * @param $locale
     *
     * @return \Illuminate\Foundation\Application|mixed
     */
    public static function bind($locale)
    {
        return app()-&gt;singleton(DateFormatPresenterInterface::class, &#39;App\Presenters\DateFormatPresenter&#39; . ucwords($locale));
    }
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>使用 <strong>Presenter Factory</strong> 的 <code>create()</code> 去取代 new 建立物件。</p><p>这里当然可以在 <code>create()</code> 里去写 <code>if () { ... } else { ... }</code> 去建立 Presenter 物件，不过这样会违反 SOLID 的开放封闭原则，比较好的方式是改用 <code>App::bind()</code>，直接根据 <code>$locale</code> 去 binding 相对应的 Class，这样无论再怎么新增语言与日期格式， Controller 与 Presenter Factory 都不用做任何修改，完全符合开放封闭原则。</p><h5 id="控制器调用"><a class="header-anchor" href="#控制器调用">#</a> 控制器调用</h5><p><code>app\Http\Controllers\UserController.php</code> 中的内容，如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public function index(Request $request, DateFormatPresenterFactory $dataFormatPresenterFactory)
{
    $locate = &#39;uk&#39;;
    $presenter = $dataFormatPresenterFactory::bind($locate);

    dd($presenter-&gt;showDateFormat(Carbon::now()));
    return $presenter;
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>使用 <code>$dataFormatPresenterFactory::bind()</code> 切换 <code>app()</code> 的 Presenter 物件，如此 Controller 将开放封闭，将来有新的语言新增或者修改需求，也不用修改 Controller</p><h5 id="blade-调用"><a class="header-anchor" href="#blade-调用">#</a> Blade 调用</h5><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;{{ config(&#39;app.locale&#39;) }}&quot;&gt;
&lt;head&gt;
    &lt;title&gt;Users&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&quot;flex-center position-ref full-height&quot;&gt;
    @inject(&#39;dateFormatPresenter&#39;,&#39;App\Presenters\DateFormatPresenterInterface&#39;)
    @foreach($users as $user)
        &lt;div&gt;
            &lt;h2&gt;&lt;?php print_r($dateFormatPresenter-&gt;showDateFormat($user-&gt;created_at)); ?&gt;&lt;/h2&gt;
        &lt;/div&gt;
    @endforeach
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>使用 <code>@inject()</code> 注入 Presenter ,让 View 也可以如 Controller 一样使用注入的物件</p><p>使用 Presenter 的 <code>showDateFormate()</code> 将日期转换成预计的格式</p><p>使用这种写法有几个优点</p><ul><li><p>将 <code>依需求显示不同的格式</code> 的显示逻辑写在 Presenter ，解决写在 Blade 不容易维护的问题</p></li><li><p>可对显示逻辑做重构与物件导向</p></li><li><p>符合 SOLID 的开放闭合原则：将来若有新的语言，对于拓展是开放的，只要新增 Class 实现 <code>DateFormatPresenterInterface</code> 接口即可；对于修改是封闭的， Controller、FactoryInterface、Factory 与 View 都不用做任何修改</p></li><li><p>不单只有 PHP 可以使用 Service Container，连 Blade 也可以使用 Service Container，甚至搭配 Service Provider</p></li><li><p>可单独对 Presenter 的显示逻辑做单元测试</p></li><li><p>若使用了 Presenter 辅助 Blade ，在搭配 <code>@inject()</code> 注入到 View，View就会非常干净，可专心处理 <code>将资料binding到HTML</code>的职责</p></li><li><p>将来只有 Layout 改变才会动到 Balde ，若是显示逻辑改变都是修改 Presenter</p></li></ul><h3 id="最后"><a class="header-anchor" href="#最后">#</a> 最后</h3><p>Presenter 使得显示逻辑从Blade 中解放，不仅更容易维护、更容易扩展、更容易重复使用且更容易测试</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">3/23/2021, 9:22:20 AM</span></div><!----></footer><!----><!--[--><!--]--></main></div><!----><!--]--></div>
    <script src="/laravel-study/assets/js/runtime~app.05435c8d.js" defer></script><script src="/laravel-study/assets/js/3070.89721d41.js" defer></script><script src="/laravel-study/assets/js/app.f1778539.js" defer></script>
  </body>
</html>
