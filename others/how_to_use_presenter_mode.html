<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.33">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Laravel 学习记录</title><meta name="description" content="Laravel学习点滴">
    <link rel="modulepreload" href="/laravel-study/assets/app.ac22b6cd.js"><link rel="modulepreload" href="/laravel-study/assets/how_to_use_presenter_mode.html.f94490a6.js"><link rel="modulepreload" href="/laravel-study/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/laravel-study/assets/how_to_use_presenter_mode.html.ae054fd8.js">
    <link rel="stylesheet" href="/laravel-study/assets/style.804f45ca.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/laravel-study/" class=""><img class="logo" src="/laravel-study/images/laravel-logo.min.svg" alt="Laravel 学习记录"><span class="site-name can-hide">Laravel 学习记录</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/laravel-study/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="基础"><span class="title">基础</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="基础"><span class="title">基础</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/laravel-study/collections/" class="" aria-label="Collection 集合"><!--[--><!--]--> Collection 集合 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/laravel-study/model/" class="" aria-label="Eloquent 模型"><!--[--><!--]--> Eloquent 模型 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="其它"><span class="title">其它</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="其它"><span class="title">其它</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/laravel-study/partials/" class="" aria-label="代码片段"><!--[--><!--]--> 代码片段 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/laravel-study/tests/" class="" aria-label="测试"><!--[--><!--]--> 测试 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/laravel-study/others/" class="router-link-active" aria-label="其它"><!--[--><!--]--> 其它 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="📖📚"><span class="title">📖📚</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="📖📚"><span class="title">📖📚</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://curder.github.io/blog/" rel="noopener noreferrer" target="_blank" aria-label="Bolg"><!--[--><!--]--> Bolg <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://curder.github.io/what-is-new-in-php/" rel="noopener noreferrer" target="_blank" aria-label="What is new in PHP"><!--[--><!--]--> What is new in PHP <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://curder.github.io/setup-mac-for-developer/" rel="noopener noreferrer" target="_blank" aria-label="Setup mac for developer"><!--[--><!--]--> Setup mac for developer <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/laravel-study/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="基础"><span class="title">基础</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="基础"><span class="title">基础</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/laravel-study/collections/" class="" aria-label="Collection 集合"><!--[--><!--]--> Collection 集合 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/laravel-study/model/" class="" aria-label="Eloquent 模型"><!--[--><!--]--> Eloquent 模型 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="其它"><span class="title">其它</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="其它"><span class="title">其它</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/laravel-study/partials/" class="" aria-label="代码片段"><!--[--><!--]--> 代码片段 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/laravel-study/tests/" class="" aria-label="测试"><!--[--><!--]--> 测试 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/laravel-study/others/" class="router-link-active" aria-label="其它"><!--[--><!--]--> 其它 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="📖📚"><span class="title">📖📚</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="📖📚"><span class="title">📖📚</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://curder.github.io/blog/" rel="noopener noreferrer" target="_blank" aria-label="Bolg"><!--[--><!--]--> Bolg <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://curder.github.io/what-is-new-in-php/" rel="noopener noreferrer" target="_blank" aria-label="What is new in PHP"><!--[--><!--]--> What is new in PHP <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://curder.github.io/setup-mac-for-developer/" rel="noopener noreferrer" target="_blank" aria-label="Setup mac for developer"><!--[--><!--]--> Setup mac for developer <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h2 id="如何使用presenter模式" tabindex="-1"><a class="header-anchor" href="#如何使用presenter模式" aria-hidden="true">#</a> 如何使用Presenter模式</h2><p>若将显示逻辑都写在 View，会造成 View 代码臃肿而难以维护，基于 SOLID 原则，应该使用 Presenter 模式辅助 View，将相关的显示逻辑封装在不同的 Presenter ，方便中大型项目的维护。</p><h3 id="版本" tabindex="-1"><a class="header-anchor" href="#版本" aria-hidden="true">#</a> 版本</h3><p>Lararvel 5.4.17</p><h2 id="显示逻辑" tabindex="-1"><a class="header-anchor" href="#显示逻辑" aria-hidden="true">#</a> 显示逻辑</h2><p>在实际开发中，显示逻辑常见的如下：</p><ul><li><p>将资料显示不同资料： 如 <code>性别字段为 M，就显示 Mr.，若性别字段为 F，就显示 Mrs.</code></p></li><li><p>是否显示某些资料：如 <code>根据字段值是否等于 T，要不要显示改字段</code></p></li><li><p>依需求显示不同格式：如 <code>依不同的语系，显示不同的日期格式</code></p></li></ul><h2 id="presenter" tabindex="-1"><a class="header-anchor" href="#presenter" aria-hidden="true">#</a> Presenter</h2><h3 id="将资料显示不同资料" tabindex="-1"><a class="header-anchor" href="#将资料显示不同资料" aria-hidden="true">#</a> 将资料显示不同资料</h3><p>如 <code>性别字段为 M，就显示 Mr.，若性别字段为 F，就显示 Mrs.</code>，我们可能会直接用 blade 写在 view 里，如下：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{ config(<span class="token punctuation">&#39;</span>app.locale<span class="token punctuation">&#39;</span>) }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Users<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex-center position-ref full-height<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    @foreach($users as $user)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>@if($user-&gt;gender == &#39;m&#39;){{ &quot;Mr.&quot; }} @else {{ &quot;Mrs.&quot; }} @endif {{$user-&gt;name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ $user-&gt;email }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    @endforeach
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>在中大型项目中，会有几个问题：</p><ul><li><p>由于 Blade 与 Html 夹杂，不太适合写太复杂的代码，只适合做一些简单的 binding ，否则很容易写成传统的 PHP 的意大利面代码</p></li><li><p>无法对显示逻辑做重构与物件导向</p></li></ul><p>比较好的方式是使用 Presenter，具体步骤如下：</p><ul><li><p>将相依无间注入到 Presenter</p></li><li><p>在 presenter 内写格式转换</p></li><li><p>将 Presenter 注入到 View</p></li></ul><h4 id="定义userpresenter" tabindex="-1"><a class="header-anchor" href="#定义userpresenter" aria-hidden="true">#</a> 定义UserPresenter</h4><p><code>app\Presenters\UserPersenter.php</code> 代码如下：</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Presenters</span><span class="token punctuation">;</span>


<span class="token doc-comment comment">/**
 * Class UserPresenter
 *
 * <span class="token keyword">@package</span> <span class="token class-name">App<span class="token punctuation">\</span>Presenters</span>
 */</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">UserPresenter</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token keyword">string</span></span> <span class="token parameter">$gender</span>
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token keyword">string</span></span> <span class="token parameter">$name</span>
     *
     * <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">string</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getFullName</span><span class="token punctuation">(</span><span class="token variable">$gender</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$gender</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&#39;M&#39;</span> <span class="token operator">?</span> <span class="token string single-quoted-string">&#39;Mr. &#39;</span> <span class="token operator">.</span> <span class="token variable">$name</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">&#39;Mrs. &#39;</span> <span class="token operator">.</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>将原本在 blade 中用 <code>@if(){ .. }@else .. @endif</code> 写的逻辑改写在 Presenter 中。</p><h4 id="视图中使用userpresenter" tabindex="-1"><a class="header-anchor" href="#视图中使用userpresenter" aria-hidden="true">#</a> 视图中使用UserPresenter</h4><p>使用 <code>@inject()</code> 注入 <code>UserPresenter</code>，让 View 可以如 Controller 一样使用注入的物件。</p><p>将来如乱显示逻辑怎么修改，都不用改到 Blade ，直接在相关 Presenter 中修改即可。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{ config(<span class="token punctuation">&#39;</span>app.locale<span class="token punctuation">&#39;</span>) }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Users<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex-center position-ref full-height<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    @inject(&#39;userPresenter&#39;,&#39;App\Presenters\UserPresenter&#39;)
    @foreach($users as $user)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        {{--<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>@if($user-&gt;gender == &#39;m&#39;){{ &quot;Mr.&quot; }} @else {{ &quot;Mrs.&quot; }} @endif {{$user-&gt;name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>--}}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ $userPresenter-&gt;getFullName($user-&gt;gender,$user-&gt;name) }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ $user-&gt;email }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    @endforeach
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>改用这种重写，有几个优点：</p><ul><li><p>将资料显示不同个格式的显示逻辑改写在 presenter，解决了 blade 不容易维护的问题</p></li><li><p>可以显示逻辑做重构于物件导向</p></li></ul><h2 id="是否显示某些资料" tabindex="-1"><a class="header-anchor" href="#是否显示某些资料" aria-hidden="true">#</a> 是否显示某些资料</h2><p>如 <code>根据字段值是否为 T ，要不要显示该字段</code>，我们常常会直接用 blade 写在 View 中。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{ config(<span class="token punctuation">&#39;</span>app.locale<span class="token punctuation">&#39;</span>) }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Users<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex-center position-ref full-height<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    @foreach($users as $user)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ $user-&gt;name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    @if($user-&gt;is_hidden == &#39;F&#39;)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ $user-&gt;email }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    @endif
    @endforeach
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>在中大型项目中，会有几个问题：</p><ul><li><p>由于 blade 与 HTML 夹杂，不太适合写太复杂的业务代码，只适合做一些简单的 binding，否则很容易写成传统的 PHP 的意大利面代码</p></li><li><p>无法对显示逻辑做重构与物件导向</p></li></ul><p>比较好的方式是使用 Presenter，具体步骤如下：</p><ul><li><p>将相依无间注入到 Presenter</p></li><li><p>在 presenter 内写格式转换</p></li><li><p>将 Presenter 注入到 View</p></li></ul><p><code>app\Presenters\UserPresenter.php</code> 代码：</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Presenters</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * Class UserPresenter
 *
 * <span class="token keyword">@package</span> <span class="token class-name">App<span class="token punctuation">\</span>Presenters</span>
 */</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">UserPresenter</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">\</span>App<span class="token punctuation">\</span>User</span> <span class="token parameter">$user</span>
     *
     * <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">string</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">showEmail</span><span class="token punctuation">(</span><span class="token class-name type-declaration">User</span> <span class="token variable">$user</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">is_hidden</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&#39;F&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string single-quoted-string">&#39;&lt;h2&gt;&#39;</span> <span class="token operator">.</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">email</span> <span class="token string single-quoted-string">&#39;&lt;/h2&gt;&#39;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>将 <code>@if() .. @endif</code> 的 boolean 判断封装在 Presenter 内，改由 Presenter 负责输出 HTML。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{ config(<span class="token punctuation">&#39;</span>app.locale<span class="token punctuation">&#39;</span>) }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Users<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex-center position-ref full-height<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    @inject(&#39;userPresenter&#39;,&#39;App\Presenters\UserPresenter&#39;)
    @foreach($users as $user)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ $user-&gt;name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    {!! $userPresenter-&gt;showEmail($user) !!}
    @endforeach
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>使用 <code>@inject()</code> 注入 <code>UserPresenter</code>，让 View 也可以如 Controller 一样使用注入的物件。</p><p><code>{!! !!}</code> 会保留原来的 HTML 格式。</p><p>将来无论显示逻辑怎么修改，都不用改到 Blade ，直接在 Presenter 内修改。</p><p>改用这种写法，有几个优点：</p><ul><li><p><code>是否显示某些资料</code> 的显示逻辑改为在 Presenter，解决写在 Blade 不容易维护的问题</p></li><li><p>可对显示逻辑做重构与物件导向</p></li></ul><h3 id="依需求显示不同格式" tabindex="-1"><a class="header-anchor" href="#依需求显示不同格式" aria-hidden="true">#</a> 依需求显示不同格式</h3><p>如 <code>按照不同的语系，显示不同的日期格式</code>，我们常常会直接用 Blade 写在 View 里。 如下：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{ config(<span class="token punctuation">&#39;</span>app.locale<span class="token punctuation">&#39;</span>) }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Users<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex-center position-ref full-height<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    @foreach($users as $user)
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
            @if(App::getLocale() == &#39;uk&#39;)
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ $user-&gt;created_at-&gt;format(&#39;d M, Y&#39;) }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
            @elseif(App::getLocale() == &#39;tw&#39;)
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ $user-&gt;creaetd_at-&gt;format(&#39;Y/m/d&#39;) }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
            @else
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ $user-&gt;created_at-&gt;formate(&#39;M d, Y&#39;) }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
            @endif
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    @endforeach
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>在中大型的醒目中，会有几个问题：</p><ul><li><p>由于 Blade 与 HTML 夹杂，不太适合写太复杂的代码，只适合做一些简单的 binding，否则很容易写成传统的 PHP 的意大利面代码</p></li><li><p>无法对显示逻辑做重构与物件导向</p></li></ul><p>比较好的方式是使用 Presenter，具体步骤如下：</p><ul><li><p>将相依无间注入到 Presenter</p></li><li><p>在 presenter 内写不同的日期格式转换逻辑</p></li><li><p>将 Presenter 注入到 View</p></li></ul><h4 id="定义接口" tabindex="-1"><a class="header-anchor" href="#定义接口" aria-hidden="true">#</a> 定义接口</h4><p>定义接口代码 <code>app\Presenters\DataFormatPresenterInterface.php</code> ，具体代码如下：</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Presenters</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Carbon<span class="token punctuation">\</span>Carbon</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * Interface DateFormatPresenterInterface
 *
 * <span class="token keyword">@package</span> <span class="token class-name">App<span class="token punctuation">\</span>Presenters</span>
 */</span>
<span class="token keyword">interface</span> <span class="token class-name-definition class-name">DateFormatPresenterInterface</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 显示日期格式
     *
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">\</span>Carbon<span class="token punctuation">\</span>Carbon</span> <span class="token parameter">$data</span>
     *
     * <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">string</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">showDateFormat</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Carbon</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>定义了 <code>showDateFormat()</code>，各语言必须在 <code>showDateFormat()</code> 使用 Carbon 的 <code>format()</code> 去转换日期格式。</p><h4 id="一些presenter" tabindex="-1"><a class="header-anchor" href="#一些presenter" aria-hidden="true">#</a> 一些Presenter</h4><p><code>app\Presenters\DateFormatPresenterTW.php</code>，具体代码内容如下：</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Presenters</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Carbon<span class="token punctuation">\</span>Carbon</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * Class DateFormatPresenterTw
 *
 * <span class="token keyword">@package</span> <span class="token class-name"><span class="token punctuation">\</span>App<span class="token punctuation">\</span>Presenters</span>
 */</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">DateFormatPresenterTw</span> <span class="token keyword">implements</span> <span class="token class-name">DateFormatPresenterInterface</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">\</span>Carbon<span class="token punctuation">\</span>Carbon</span> <span class="token parameter">$date</span>
     *
     * <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">string</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">showDateFormat</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Carbon</span> <span class="token variable">$date</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$date</span><span class="token operator">-&gt;</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;Y/m/d&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><code>app\Presenters\DateFormatPresenterUk.php</code>，具体代码内容如下：</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Presenters</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Carbon<span class="token punctuation">\</span>Carbon</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * Class DateFormatPresenterUk
 *
 * <span class="token keyword">@package</span> <span class="token class-name"><span class="token punctuation">\</span>App<span class="token punctuation">\</span>Presenters</span>
 */</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">DateFormatPresenterUk</span> <span class="token keyword">implements</span> <span class="token class-name">DateFormatPresenterInterface</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">\</span>Carbon<span class="token punctuation">\</span>Carbon</span> <span class="token parameter">$data</span>
     *
     * <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">string</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">showDateFormat</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Carbon</span> <span class="token variable">$data</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$data</span><span class="token operator">-&gt;</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;d M, Y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><code>app\Presenters\DateFormatPresenterUs.php</code>，具体代码内容如下：</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Presenters</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Carbon<span class="token punctuation">\</span>Carbon</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * Class DateFormatPresenterUs
 *
 * <span class="token keyword">@package</span> <span class="token class-name"><span class="token punctuation">\</span>App<span class="token punctuation">\</span>Presenters</span>
 */</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">DateFormatPresenterUs</span> <span class="token keyword">implements</span> <span class="token class-name">DateFormatPresenterInterface</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">\</span>Carbon<span class="token punctuation">\</span>Carbon</span> <span class="token parameter">$date</span>
     *
     * <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">string</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">showDateFormat</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Carbon</span> <span class="token variable">$date</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$date</span><span class="token operator">-&gt;</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;M d,Y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>以上类都实现了 <code>DateFormatPresenterInterface</code> 接口，并将转换成相对应国家日期格式的 Carbon 的 <code>format()</code> 写在 <code>showDateFormat()</code> 内。</p><h4 id="presenter-工厂" tabindex="-1"><a class="header-anchor" href="#presenter-工厂" aria-hidden="true">#</a> Presenter 工厂</h4><p>由于每个语言的日期格式都是一个 presenter 物件，那势必遇到一个最基本的问题： <code>我们必须根据不同的语言去实例化不同的 Presenter 物件</code>，我们可能会在 Controller 中去 实例化。如下：</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">\</span>Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span> <span class="token parameter">$request</span>
 *
 * <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">int</span></span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$locate</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;hk&#39;</span><span class="token punctuation">;</span>
   <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$locate</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">case</span> <span class="token string single-quoted-string">&#39;uk&#39;</span><span class="token punctuation">:</span>
           <span class="token variable">$presenter</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateFormatPresenterUk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">break</span><span class="token punctuation">;</span>
       <span class="token keyword">case</span> <span class="token string single-quoted-string">&#39;tw&#39;</span><span class="token punctuation">:</span>
           <span class="token variable">$presenter</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateFormatPresenterTw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">break</span><span class="token punctuation">;</span>
       <span class="token keyword">default</span><span class="token punctuation">:</span>
           <span class="token variable">$presenter</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateFormatPresenterUs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> <span class="token variable">$presenter</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>这种写法虽然可行，但是有如下问题：</p><ul><li><p>违反了 SOLID 的开放封闭原则：若将来有新的语言需求，只能不断去修改 <code>index()</code> ，然后不断的新增 <code>elseif()</code> ，计算改用 <code>switch{ .. }</code> 也是一样</p></li><li><p>违反了 SOLID 的依赖反转原则：Controller 直接根据语言去实例化对应的 Class ，高层直接相依于底层，直接将实例化对象写死在代码里</p></li><li><p>无法单元测试：由于 Presenter 直接 New 在 Controller ，因此要测试时，无法对 Presenter 做 mock</p></li></ul><h5 id="定义工厂" tabindex="-1"><a class="header-anchor" href="#定义工厂" aria-hidden="true">#</a> 定义工厂</h5><p>比较好的解决方式是使用 <strong>Factory Pattern</strong></p><p><code>app/Presenters/DateFormatPresenterFactory.php</code> 内容如下：</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Presenters</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * Class DateFormatPresenterFactory
 *
 * <span class="token keyword">@package</span> <span class="token class-name"><span class="token punctuation">\</span>App<span class="token punctuation">\</span>Presenters</span>
 */</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">DateFormatPresenterFactory</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token parameter">$locale</span>
     *
     * <span class="token keyword">@return</span> <span class="token class-name"><span class="token punctuation">\</span>Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Application<span class="token punctuation">|</span><span class="token keyword">mixed</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">bind</span><span class="token punctuation">(</span><span class="token variable">$locale</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">singleton</span><span class="token punctuation">(</span><span class="token class-name static-context">DateFormatPresenterInterface</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;App\Presenters\DateFormatPresenter&#39;</span> <span class="token operator">.</span> <span class="token function">ucwords</span><span class="token punctuation">(</span><span class="token variable">$locale</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>使用 <strong>Presenter Factory</strong> 的 <code>create()</code> 去取代 new 建立物件。</p><p>这里当然可以在 <code>create()</code> 里去写 <code>if () { ... } else { ... }</code> 去建立 Presenter 物件，不过这样会违反 SOLID 的开放封闭原则，比较好的方式是改用 <code>App::bind()</code> ，直接根据 <code>$locale</code> 去 binding 相对应的 Class，这样无论再怎么新增语言与日期格式， Controller 与 Presenter Factory 都不用做任何修改，完全符合开放封闭原则。</p><h5 id="控制器调用" tabindex="-1"><a class="header-anchor" href="#控制器调用" aria-hidden="true">#</a> 控制器调用</h5><p><code>app\Http\Controllers\UserController.php</code> 中的内容，如下：</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token class-name type-declaration">DateFormatPresenterFactory</span> <span class="token variable">$dataFormatPresenterFactory</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$locate</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;uk&#39;</span><span class="token punctuation">;</span>
    <span class="token variable">$presenter</span> <span class="token operator">=</span> <span class="token variable">$dataFormatPresenterFactory</span><span class="token operator">::</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token variable">$locate</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">dd</span><span class="token punctuation">(</span><span class="token variable">$presenter</span><span class="token operator">-&gt;</span><span class="token function">showDateFormat</span><span class="token punctuation">(</span><span class="token class-name static-context">Carbon</span><span class="token operator">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$presenter</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>使用 <code>$dataFormatPresenterFactory::bind()</code> 切换 <code>app()</code> 的 Presenter 物件，如此 Controller 将开放封闭，将来有新的语言新增或者修改需求，也不用修改 Controller</p><h5 id="blade-调用" tabindex="-1"><a class="header-anchor" href="#blade-调用" aria-hidden="true">#</a> Blade 调用</h5><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{ config(<span class="token punctuation">&#39;</span>app.locale<span class="token punctuation">&#39;</span>) }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Users<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex-center position-ref full-height<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    @inject(&#39;dateFormatPresenter&#39;,&#39;App\Presenters\DateFormatPresenterInterface&#39;)
    @foreach($users as $user)
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token prolog">&lt;?php print_r($dateFormatPresenter-&gt;showDateFormat($user-&gt;created_at)); ?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    @endforeach
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>使用 <code>@inject()</code> 注入 Presenter ,让 View 也可以如 Controller 一样使用注入的物件</p><p>使用 Presenter 的 <code>showDateFormate()</code> 将日期转换成预计的格式</p><p>使用这种写法有几个优点</p><ul><li><p>将 <code>依需求显示不同的格式</code> 的显示逻辑写在 Presenter ，解决写在 Blade 不容易维护的问题</p></li><li><p>可对显示逻辑做重构与物件导向</p></li><li><p>符合 SOLID 的开放闭合原则：将来若有新的语言，对于拓展是开放的，只要新增 Class 实现 <code>DateFormatPresenterInterface</code> 接口即可；对于修改是封闭的， Controller、FactoryInterface、Factory 与 View 都不用做任何修改</p></li><li><p>不单只有 PHP 可以使用 Service Container，连 Blade 也可以使用 Service Container，甚至搭配 Service Provider</p></li><li><p>可单独对 Presenter 的显示逻辑做单元测试</p></li><li><p>若使用了 Presenter 辅助 Blade ，在搭配 <code>@inject()</code> 注入到 View，View就会非常干净，可专心处理 <code>将资料binding到HTML</code>的职责</p></li><li><p>将来只有 Layout 改变才会动到 Blade ，若是显示逻辑改变都是修改 Presenter</p></li></ul><h3 id="最后" tabindex="-1"><a class="header-anchor" href="#最后" aria-hidden="true">#</a> 最后</h3><p>Presenter 使得显示逻辑从Blade 中解放，不仅更容易维护、更容易扩展、更容易重复使用且更容易测试</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: q.curder@gmail.com">curder</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/laravel-study/assets/app.ac22b6cd.js" defer></script>
  </body>
</html>
