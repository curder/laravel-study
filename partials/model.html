<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.33">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Model æ¨¡å‹ | Laravel å­¦ä¹ è®°å½•</title><meta name="description" content="Laravelå­¦ä¹ ç‚¹æ»´">
    <link rel="modulepreload" href="/laravel-study/assets/app.3ee12f16.js"><link rel="modulepreload" href="/laravel-study/assets/model.html.7ad2b32d.js"><link rel="modulepreload" href="/laravel-study/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/laravel-study/assets/model.html.263e6506.js">
    <link rel="stylesheet" href="/laravel-study/assets/style.804f45ca.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/laravel-study/" class=""><img class="logo" src="/laravel-study/images/laravel-logo.min.svg" alt="Laravel å­¦ä¹ è®°å½•"><span class="site-name can-hide">Laravel å­¦ä¹ è®°å½•</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/laravel-study/" class="" aria-label="é¦–é¡µ"><!--[--><!--]--> é¦–é¡µ <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="åŸºç¡€"><span class="title">åŸºç¡€</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="åŸºç¡€"><span class="title">åŸºç¡€</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/laravel-study/collections/" class="" aria-label="Collection é›†åˆ"><!--[--><!--]--> Collection é›†åˆ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/laravel-study/model/" class="" aria-label="Eloquent æ¨¡å‹"><!--[--><!--]--> Eloquent æ¨¡å‹ <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="å…¶å®ƒ"><span class="title">å…¶å®ƒ</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="å…¶å®ƒ"><span class="title">å…¶å®ƒ</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/laravel-study/partials/" class="router-link-active" aria-label="ä»£ç ç‰‡æ®µ"><!--[--><!--]--> ä»£ç ç‰‡æ®µ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/laravel-study/tests/" class="" aria-label="æµ‹è¯•"><!--[--><!--]--> æµ‹è¯• <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/laravel-study/others/" class="" aria-label="å…¶å®ƒ"><!--[--><!--]--> å…¶å®ƒ <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ“–ğŸ“š"><span class="title">ğŸ“–ğŸ“š</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ“–ğŸ“š"><span class="title">ğŸ“–ğŸ“š</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://curder.github.io/blog/" rel="noopener noreferrer" target="_blank" aria-label="Bolg"><!--[--><!--]--> Bolg <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://curder.github.io/what-is-new-in-php/" rel="noopener noreferrer" target="_blank" aria-label="What is new in PHP"><!--[--><!--]--> What is new in PHP <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://curder.github.io/setup-mac-for-developer/" rel="noopener noreferrer" target="_blank" aria-label="Setup mac for developer"><!--[--><!--]--> Setup mac for developer <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/laravel-study/" class="" aria-label="é¦–é¡µ"><!--[--><!--]--> é¦–é¡µ <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="åŸºç¡€"><span class="title">åŸºç¡€</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="åŸºç¡€"><span class="title">åŸºç¡€</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/laravel-study/collections/" class="" aria-label="Collection é›†åˆ"><!--[--><!--]--> Collection é›†åˆ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/laravel-study/model/" class="" aria-label="Eloquent æ¨¡å‹"><!--[--><!--]--> Eloquent æ¨¡å‹ <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="å…¶å®ƒ"><span class="title">å…¶å®ƒ</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="å…¶å®ƒ"><span class="title">å…¶å®ƒ</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/laravel-study/partials/" class="router-link-active" aria-label="ä»£ç ç‰‡æ®µ"><!--[--><!--]--> ä»£ç ç‰‡æ®µ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/laravel-study/tests/" class="" aria-label="æµ‹è¯•"><!--[--><!--]--> æµ‹è¯• <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/laravel-study/others/" class="" aria-label="å…¶å®ƒ"><!--[--><!--]--> å…¶å®ƒ <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ“–ğŸ“š"><span class="title">ğŸ“–ğŸ“š</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ“–ğŸ“š"><span class="title">ğŸ“–ğŸ“š</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://curder.github.io/blog/" rel="noopener noreferrer" target="_blank" aria-label="Bolg"><!--[--><!--]--> Bolg <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://curder.github.io/what-is-new-in-php/" rel="noopener noreferrer" target="_blank" aria-label="What is new in PHP"><!--[--><!--]--> What is new in PHP <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://curder.github.io/setup-mac-for-developer/" rel="noopener noreferrer" target="_blank" aria-label="Setup mac for developer"><!--[--><!--]--> Setup mac for developer <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p class="sidebar-item sidebar-heading active">ä»£ç ç‰‡æ®µ <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/laravel-study/partials/blade.html" class="sidebar-item" aria-label="Blade æ¨¡ç‰ˆ"><!--[--><!--]--> Blade æ¨¡ç‰ˆ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Model æ¨¡å‹"><!--[--><!--]--> Model æ¨¡å‹ <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/laravel-study/partials/model.html#åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ–°å¢-wasrecentlycreated" class="router-link-active router-link-exact-active sidebar-item" aria-label="åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ–°å¢ wasRecentlyCreated"><!--[--><!--]--> åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ–°å¢ wasRecentlyCreated <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#é‡ç”¨æˆ–å…‹éš†æŸ¥è¯¢" class="router-link-active router-link-exact-active sidebar-item" aria-label="é‡ç”¨æˆ–å…‹éš†æŸ¥è¯¢"><!--[--><!--]--> é‡ç”¨æˆ–å…‹éš†æŸ¥è¯¢ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æ¨¡å‹çš„æ—¶é—´æŸ¥è¯¢æ–¹æ³•" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ¨¡å‹çš„æ—¶é—´æŸ¥è¯¢æ–¹æ³•"><!--[--><!--]--> æ¨¡å‹çš„æ—¶é—´æŸ¥è¯¢æ–¹æ³• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#å¢å‡æŸä¸ªå­—æ®µ" class="router-link-active router-link-exact-active sidebar-item" aria-label="å¢å‡æŸä¸ªå­—æ®µ"><!--[--><!--]--> å¢å‡æŸä¸ªå­—æ®µ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#è¡¨ä¸å­˜åœ¨æ—¶é—´å­—æ®µ" class="router-link-active router-link-exact-active sidebar-item" aria-label="è¡¨ä¸å­˜åœ¨æ—¶é—´å­—æ®µ"><!--[--><!--]--> è¡¨ä¸å­˜åœ¨æ—¶é—´å­—æ®µ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#è½¯åˆ é™¤-å¤šæ¬¡è¿˜åŸ" class="router-link-active router-link-exact-active sidebar-item" aria-label="è½¯åˆ é™¤ï¼šå¤šæ¬¡è¿˜åŸ"><!--[--><!--]--> è½¯åˆ é™¤ï¼šå¤šæ¬¡è¿˜åŸ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#all-æ–¹æ³•å€¼å®šè¿”å›å­—æ®µ" class="router-link-active router-link-exact-active sidebar-item" aria-label="all æ–¹æ³•å€¼å®šè¿”å›å­—æ®µ"><!--[--><!--]--> all æ–¹æ³•å€¼å®šè¿”å›å­—æ®µ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æ˜¯å¦è¿”å›å¤±è´¥è¿˜æ˜¯æ¨¡å‹å®ä¾‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ˜¯å¦è¿”å›å¤±è´¥è¿˜æ˜¯æ¨¡å‹å®ä¾‹"><!--[--><!--]--> æ˜¯å¦è¿”å›å¤±è´¥è¿˜æ˜¯æ¨¡å‹å®ä¾‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#findorfail-æ–¹æ³•è¿˜æ¥å—ä¸»é”®æ•°ç»„" class="router-link-active router-link-exact-active sidebar-item" aria-label="findOrFail() æ–¹æ³•è¿˜æ¥å—ä¸»é”®æ•°ç»„"><!--[--><!--]--> findOrFail() æ–¹æ³•è¿˜æ¥å—ä¸»é”®æ•°ç»„ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#ä¿®æ”¹æ•°æ®åº“å­—æ®µ" class="router-link-active router-link-exact-active sidebar-item" aria-label="ä¿®æ”¹æ•°æ®åº“å­—æ®µ"><!--[--><!--]--> ä¿®æ”¹æ•°æ®åº“å­—æ®µ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æŸ¥è¯¢ç»“æœé›†ä½¿ç”¨mapå›è°ƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="æŸ¥è¯¢ç»“æœé›†ä½¿ç”¨mapå›è°ƒ"><!--[--><!--]--> æŸ¥è¯¢ç»“æœé›†ä½¿ç”¨mapå›è°ƒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#ä¿®æ”¹é»˜è®¤çš„æ—¶é—´å­—æ®µ" class="router-link-active router-link-exact-active sidebar-item" aria-label="ä¿®æ”¹é»˜è®¤çš„æ—¶é—´å­—æ®µ"><!--[--><!--]--> ä¿®æ”¹é»˜è®¤çš„æ—¶é—´å­—æ®µ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#é€šè¿‡æŸä¸ªå­—æ®µå¿«é€Ÿæ’åº" class="router-link-active router-link-exact-active sidebar-item" aria-label="é€šè¿‡æŸä¸ªå­—æ®µå¿«é€Ÿæ’åº"><!--[--><!--]--> é€šè¿‡æŸä¸ªå­—æ®µå¿«é€Ÿæ’åº <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æ•°æ®åº“åŸå§‹æŸ¥è¯¢è®¡ç®—è¿è¡Œå¾—æ›´å¿«" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ•°æ®åº“åŸå§‹æŸ¥è¯¢è®¡ç®—è¿è¡Œå¾—æ›´å¿«"><!--[--><!--]--> æ•°æ®åº“åŸå§‹æŸ¥è¯¢è®¡ç®—è¿è¡Œå¾—æ›´å¿« <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#å¤šä¸ª-scope-æŸ¥è¯¢" class="router-link-active router-link-exact-active sidebar-item" aria-label="å¤šä¸ª scope æŸ¥è¯¢"><!--[--><!--]--> å¤šä¸ª scope æŸ¥è¯¢ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æ— éœ€è½¬æ¢-carbon" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ— éœ€è½¬æ¢ carbon"><!--[--><!--]--> æ— éœ€è½¬æ¢ carbon <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æŒ‰é¦–å­—æ¯åˆ†ç»„" class="router-link-active router-link-exact-active sidebar-item" aria-label="æŒ‰é¦–å­—æ¯åˆ†ç»„"><!--[--><!--]--> æŒ‰é¦–å­—æ¯åˆ†ç»„ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#å­—æ®µä»…æ›´æ–°ä¸€æ¬¡" class="router-link-active router-link-exact-active sidebar-item" aria-label="å­—æ®µä»…æ›´æ–°ä¸€æ¬¡"><!--[--><!--]--> å­—æ®µä»…æ›´æ–°ä¸€æ¬¡ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#find-æ–¹æ³•é’ˆå¯¹ä¸»é”®æŸ¥è¯¢æ›´å¤š" class="router-link-active router-link-exact-active sidebar-item" aria-label="find æ–¹æ³•é’ˆå¯¹ä¸»é”®æŸ¥è¯¢æ›´å¤š"><!--[--><!--]--> find æ–¹æ³•é’ˆå¯¹ä¸»é”®æŸ¥è¯¢æ›´å¤š <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#ä½¿ç”¨uuidä»£æ›¿ä¸»é”®è‡ªå¢" class="router-link-active router-link-exact-active sidebar-item" aria-label="ä½¿ç”¨UUIDä»£æ›¿ä¸»é”®è‡ªå¢"><!--[--><!--]--> ä½¿ç”¨UUIDä»£æ›¿ä¸»é”®è‡ªå¢ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#å­æŸ¥è¯¢" class="router-link-active router-link-exact-active sidebar-item" aria-label="å­æŸ¥è¯¢"><!--[--><!--]--> å­æŸ¥è¯¢ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#éšè—ä¸€äº›å­—æ®µ" class="router-link-active router-link-exact-active sidebar-item" aria-label="éšè—ä¸€äº›å­—æ®µ"><!--[--><!--]--> éšè—ä¸€äº›å­—æ®µ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æ•æ‰æ•°æ®åº“é”™è¯¯" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ•æ‰æ•°æ®åº“é”™è¯¯"><!--[--><!--]--> æ•æ‰æ•°æ®åº“é”™è¯¯ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æŸ¥è¯¢ç”Ÿæˆ-è½¯åˆ é™¤" class="router-link-active router-link-exact-active sidebar-item" aria-label="æŸ¥è¯¢ç”Ÿæˆ - è½¯åˆ é™¤"><!--[--><!--]--> æŸ¥è¯¢ç”Ÿæˆ - è½¯åˆ é™¤ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#sql-æŸ¥è¯¢" class="router-link-active router-link-exact-active sidebar-item" aria-label="SQL æŸ¥è¯¢"><!--[--><!--]--> SQL æŸ¥è¯¢ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#ä½¿ç”¨dbäº‹åŠ¡" class="router-link-active router-link-exact-active sidebar-item" aria-label="ä½¿ç”¨DBäº‹åŠ¡"><!--[--><!--]--> ä½¿ç”¨DBäº‹åŠ¡ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æ›´æ–°æˆ–åˆ›å»º" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ›´æ–°æˆ–åˆ›å»º"><!--[--><!--]--> æ›´æ–°æˆ–åˆ›å»º <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æ›´æ”¹æ—¥æœŸæ ¼å¼" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ›´æ”¹æ—¥æœŸæ ¼å¼"><!--[--><!--]--> æ›´æ”¹æ—¥æœŸæ ¼å¼ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#åœ¨jsonå­—æ®µä¸­å­˜å‚¨æ•°ç»„" class="router-link-active router-link-exact-active sidebar-item" aria-label="åœ¨JSONå­—æ®µä¸­å­˜å‚¨æ•°ç»„"><!--[--><!--]--> åœ¨JSONå­—æ®µä¸­å­˜å‚¨æ•°ç»„ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æ¨¡å‹çš„å‰¯æœ¬" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ¨¡å‹çš„å‰¯æœ¬"><!--[--><!--]--> æ¨¡å‹çš„å‰¯æœ¬ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#åˆ é™¤æ¨¡å‹ä¹‹å‰æ‰§è¡Œä»»ä½•é¢å¤–æ­¥éª¤" class="router-link-active router-link-exact-active sidebar-item" aria-label="åˆ é™¤æ¨¡å‹ä¹‹å‰æ‰§è¡Œä»»ä½•é¢å¤–æ­¥éª¤"><!--[--><!--]--> åˆ é™¤æ¨¡å‹ä¹‹å‰æ‰§è¡Œä»»ä½•é¢å¤–æ­¥éª¤ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#å°†æ•°æ®æŒä¹…åŒ–åˆ°æ•°æ®åº“æ—¶è‡ªåŠ¨å¡«å……åˆ—" class="router-link-active router-link-exact-active sidebar-item" aria-label="å°†æ•°æ®æŒä¹…åŒ–åˆ°æ•°æ®åº“æ—¶è‡ªåŠ¨å¡«å……åˆ—"><!--[--><!--]--> å°†æ•°æ®æŒä¹…åŒ–åˆ°æ•°æ®åº“æ—¶è‡ªåŠ¨å¡«å……åˆ— <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#åˆ†ææŸ¥è¯¢" class="router-link-active router-link-exact-active sidebar-item" aria-label="åˆ†ææŸ¥è¯¢"><!--[--><!--]--> åˆ†ææŸ¥è¯¢ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#dontexist-æ–¹æ³•" class="router-link-active router-link-exact-active sidebar-item" aria-label="dontExist() æ–¹æ³•"><!--[--><!--]--> dontExist() æ–¹æ³• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æ·»åŠ æ¨¡å‹çš„traitä¸”è‡ªåŠ¨è°ƒç”¨å®ƒä»¬çš„-boot-æ–¹æ³•" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ·»åŠ æ¨¡å‹çš„Traitä¸”è‡ªåŠ¨è°ƒç”¨å®ƒä»¬çš„ boot() æ–¹æ³•"><!--[--><!--]--> æ·»åŠ æ¨¡å‹çš„Traitä¸”è‡ªåŠ¨è°ƒç”¨å®ƒä»¬çš„ boot() æ–¹æ³• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#å¦‚ä½•é˜²æ­¢-éå¯¹è±¡å±æ€§-é”™è¯¯" class="router-link-active router-link-exact-active sidebar-item" aria-label="å¦‚ä½•é˜²æ­¢â€œéå¯¹è±¡å±æ€§â€é”™è¯¯"><!--[--><!--]--> å¦‚ä½•é˜²æ­¢â€œéå¯¹è±¡å±æ€§â€é”™è¯¯ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#ä¿®æ”¹æ¨¡å‹è®°å½•åè·å–åŸå§‹å±æ€§-getoriginal" class="router-link-active router-link-exact-active sidebar-item" aria-label="ä¿®æ”¹æ¨¡å‹è®°å½•åè·å–åŸå§‹å±æ€§ getOriginal()"><!--[--><!--]--> ä¿®æ”¹æ¨¡å‹è®°å½•åè·å–åŸå§‹å±æ€§ getOriginal() <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#å¡«å……æ•°æ®åº“çš„ç®€å•æ–¹æ³•" class="router-link-active router-link-exact-active sidebar-item" aria-label="å¡«å……æ•°æ®åº“çš„ç®€å•æ–¹æ³•"><!--[--><!--]--> å¡«å……æ•°æ®åº“çš„ç®€å•æ–¹æ³• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æŒ‰ä¸­é—´è¡¨å­—æ®µæ’åº" class="router-link-active router-link-exact-active sidebar-item" aria-label="æŒ‰ä¸­é—´è¡¨å­—æ®µæ’åº"><!--[--><!--]--> æŒ‰ä¸­é—´è¡¨å­—æ®µæ’åº <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æŸ¥æ‰¾å•ä¸ªè®°å½•" class="router-link-active router-link-exact-active sidebar-item" aria-label="æŸ¥æ‰¾å•ä¸ªè®°å½•"><!--[--><!--]--> æŸ¥æ‰¾å•ä¸ªè®°å½• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#chuckmap-å¤„ç†ç»“æœ" class="router-link-active router-link-exact-active sidebar-item" aria-label="chuckMap å¤„ç†ç»“æœ"><!--[--><!--]--> chuckMap å¤„ç†ç»“æœ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æ›´æ–°æ¨¡å‹ä½†ä¸è§¦å‘äº‹ä»¶" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ›´æ–°æ¨¡å‹ä½†ä¸è§¦å‘äº‹ä»¶"><!--[--><!--]--> æ›´æ–°æ¨¡å‹ä½†ä¸è§¦å‘äº‹ä»¶ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#å®šæœŸæ¸…ç†è¿‡æ—¶è®°å½•ä¸­çš„æ¨¡å‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="å®šæœŸæ¸…ç†è¿‡æ—¶è®°å½•ä¸­çš„æ¨¡å‹"><!--[--><!--]--> å®šæœŸæ¸…ç†è¿‡æ—¶è®°å½•ä¸­çš„æ¨¡å‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#ä¸å¯å˜çš„æ—¥æœŸ" class="router-link-active router-link-exact-active sidebar-item" aria-label="ä¸å¯å˜çš„æ—¥æœŸ"><!--[--><!--]--> ä¸å¯å˜çš„æ—¥æœŸ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#withaggregate-æ–¹æ³•" class="router-link-active router-link-exact-active sidebar-item" aria-label="withAggregate æ–¹æ³•"><!--[--><!--]--> withAggregate æ–¹æ³• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#upsert-æ–¹æ³•æ’å…¥æˆ–æ›´æ–°å¤šæ¡è®°å½•" class="router-link-active router-link-exact-active sidebar-item" aria-label="upsert() æ–¹æ³•æ’å…¥æˆ–æ›´æ–°å¤šæ¡è®°å½•"><!--[--><!--]--> upsert() æ–¹æ³•æ’å…¥æˆ–æ›´æ–°å¤šæ¡è®°å½• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#è¿‡æ»¤ç»“æœåæ£€ç´¢æŸ¥è¯¢ç”Ÿæˆå™¨" class="router-link-active router-link-exact-active sidebar-item" aria-label="è¿‡æ»¤ç»“æœåæ£€ç´¢æŸ¥è¯¢ç”Ÿæˆå™¨"><!--[--><!--]--> è¿‡æ»¤ç»“æœåæ£€ç´¢æŸ¥è¯¢ç”Ÿæˆå™¨ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#è‡ªå®šæœ‰æ•°æ®è½¬æ¢" class="router-link-active router-link-exact-active sidebar-item" aria-label="è‡ªå®šæœ‰æ•°æ®è½¬æ¢"><!--[--><!--]--> è‡ªå®šæœ‰æ•°æ®è½¬æ¢ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æ ¹æ®ç›¸å…³æ¨¡å‹çš„å¹³å‡å€¼æˆ–è®¡æ•°æ’åº" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ ¹æ®ç›¸å…³æ¨¡å‹çš„å¹³å‡å€¼æˆ–è®¡æ•°æ’åº"><!--[--><!--]--> æ ¹æ®ç›¸å…³æ¨¡å‹çš„å¹³å‡å€¼æˆ–è®¡æ•°æ’åº <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#è¿”å›äº‹åŠ¡ç»“æœ" class="router-link-active router-link-exact-active sidebar-item" aria-label="è¿”å›äº‹åŠ¡ç»“æœ"><!--[--><!--]--> è¿”å›äº‹åŠ¡ç»“æœ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æŸ¥è¯¢ä¸­åˆ é™¤-globalscopes" class="router-link-active router-link-exact-active sidebar-item" aria-label="æŸ¥è¯¢ä¸­åˆ é™¤ globalScopes()"><!--[--><!--]--> æŸ¥è¯¢ä¸­åˆ é™¤ globalScopes() <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æŒ‰-json-å­—æ®µå€¼æ’åº-mysql" class="router-link-active router-link-exact-active sidebar-item" aria-label="æŒ‰ JSON å­—æ®µå€¼æ’åºï¼ˆMySQLï¼‰"><!--[--><!--]--> æŒ‰ JSON å­—æ®µå€¼æ’åºï¼ˆMySQLï¼‰ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#ä»ç¬¬ä¸€ä¸ªç»“æœä¸­è·å–å•åˆ—çš„å€¼-value" class="router-link-active router-link-exact-active sidebar-item" aria-label="ä»ç¬¬ä¸€ä¸ªç»“æœä¸­è·å–å•åˆ—çš„å€¼ value()"><!--[--><!--]--> ä»ç¬¬ä¸€ä¸ªç»“æœä¸­è·å–å•åˆ—çš„å€¼ value() <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#æ£€æŸ¥æ›´æ”¹çš„å€¼æ˜¯å¦æ›´æ”¹" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ£€æŸ¥æ›´æ”¹çš„å€¼æ˜¯å¦æ›´æ”¹"><!--[--><!--]--> æ£€æŸ¥æ›´æ”¹çš„å€¼æ˜¯å¦æ›´æ”¹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#å®šä¹‰è®¿é—®å™¨å’Œä¿®æ”¹å™¨çš„æ–°æ–¹æ³•" class="router-link-active router-link-exact-active sidebar-item" aria-label="å®šä¹‰è®¿é—®å™¨å’Œä¿®æ”¹å™¨çš„æ–°æ–¹æ³•"><!--[--><!--]--> å®šä¹‰è®¿é—®å™¨å’Œä¿®æ”¹å™¨çš„æ–°æ–¹æ³• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#ä¿å­˜æ¨¡å‹åŠå…¶æ‰€æœ‰å…³ç³»" class="router-link-active router-link-exact-active sidebar-item" aria-label="ä¿å­˜æ¨¡å‹åŠå…¶æ‰€æœ‰å…³ç³»"><!--[--><!--]--> ä¿å­˜æ¨¡å‹åŠå…¶æ‰€æœ‰å…³ç³» <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/laravel-study/partials/model.html#è·å–æŸ¥è¯¢æ—¥å¿—" class="router-link-active router-link-exact-active sidebar-item" aria-label="è·å–æŸ¥è¯¢æ—¥å¿—"><!--[--><!--]--> è·å–æŸ¥è¯¢æ—¥å¿— <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/laravel-study/partials/routing.html" class="sidebar-item" aria-label="Routing è·¯ç”±"><!--[--><!--]--> Routing è·¯ç”± <!--[--><!--]--></a><!----></li><li><a href="/laravel-study/partials/testing.html" class="sidebar-item" aria-label="Testing æµ‹è¯•"><!--[--><!--]--> Testing æµ‹è¯• <!--[--><!--]--></a><!----></li><li><a href="/laravel-study/partials/urls.html" class="sidebar-item" aria-label="URL ç”Ÿæˆ"><!--[--><!--]--> URL ç”Ÿæˆ <!--[--><!--]--></a><!----></li><li><a href="/laravel-study/partials/validation.html" class="sidebar-item" aria-label="Validation éªŒè¯"><!--[--><!--]--> Validation éªŒè¯ <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="model-æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#model-æ¨¡å‹" aria-hidden="true">#</a> Model æ¨¡å‹</h1><h2 id="åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ–°å¢-wasrecentlycreated" tabindex="-1"><a class="header-anchor" href="#åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ–°å¢-wasrecentlycreated" aria-hidden="true">#</a> åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ–°å¢ <code>wasRecentlyCreated</code></h2><p>åœ¨ Laravel ä¸­ï¼Œæœ‰æ—¶å¯èƒ½éœ€è¦æ£€æŸ¥æ¨¡å‹æ˜¯ä»æ•°æ®åº“ä¸­è·å–çš„è¿˜æ˜¯åˆšåˆšåœ¨å½“å‰è¯·æ±‚ç”Ÿå‘½å‘¨æœŸä¸­åˆ›å»ºçš„â€”â€”æ¯”å¦‚ä½¿ç”¨ <code>firstOrCreate()</code> æ—¶ã€‚</p><p>ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥åœ¨æ¨¡å‹ä¸Šä½¿ç”¨ <code>-&gt;wasRecentlyCreated</code> å­—æ®µã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">createOrUpdate</span><span class="token punctuation">(</span>
<span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;email&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;email&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;name&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">wasRecentlyCreated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ç”¨æˆ·æ–°å¢é€»è¾‘ä»£ç </span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// ç”¨æˆ·å·²å­˜åœ¨å¹¶ä»æ•°æ®åº“ä¸­è·å–</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="é‡ç”¨æˆ–å…‹éš†æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#é‡ç”¨æˆ–å…‹éš†æŸ¥è¯¢" aria-hidden="true">#</a> é‡ç”¨æˆ–å…‹éš†æŸ¥è¯¢</h2><p>é€šå¸¸ï¼Œéœ€è¦ä»è¿‡æ»¤åçš„æŸ¥è¯¢å†è¿›è¡Œå¤šæ¬¡æŸ¥è¯¢ã€‚å¤§å¤šæ•°æ—¶å€™ä½¿ç”¨ <code>query()</code> æ–¹æ³•ï¼Œç¼–å†™ä¸€ä¸ªæŸ¥è¯¢æ¥è·å–åˆ›å»ºçš„æ´»è·ƒå’Œéæ´»è·ƒäº§å“ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$query</span> <span class="token operator">=</span> <span class="token class-name static-context">Product</span><span class="token operator">::</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$today</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">q_date</span> <span class="token operator">??</span> <span class="token function">today</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$today</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;created_at&#39;</span><span class="token punctuation">,</span> <span class="token variable">$today</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$active_products</span> <span class="token operator">=</span> <span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;status&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸ä¼šä¿®æ”¹ $query å˜é‡</span>
<span class="token variable">$inactive_products</span> <span class="token operator">=</span> <span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;status&#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä» $query ä¸­è·å–æ­£ç¡®çš„äº§å“</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="æ¨¡å‹çš„æ—¶é—´æŸ¥è¯¢æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#æ¨¡å‹çš„æ—¶é—´æŸ¥è¯¢æ–¹æ³•" aria-hidden="true">#</a> æ¨¡å‹çš„æ—¶é—´æŸ¥è¯¢æ–¹æ³•</h2><p>Laravel æä¾›äº†ä¸€äº›æ—¶é—´æŸ¥è¯¢æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š<code>whereDate</code>ã€<code>whereMonth</code>ã€<code>whereDay</code>ã€<code>whereYear</code>ã€<code>whereTime</code>ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$products</span> <span class="token operator">=</span> <span class="token class-name static-context">Product</span><span class="token operator">::</span><span class="token function">whereDate</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;created_at&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;2018-01-31&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$products</span> <span class="token operator">=</span> <span class="token class-name static-context">Product</span><span class="token operator">::</span><span class="token function">whereMonth</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;created_at&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;12&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$products</span> <span class="token operator">=</span> <span class="token class-name static-context">Product</span><span class="token operator">::</span><span class="token function">whereDay</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;created_at&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;31&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$products</span> <span class="token operator">=</span> <span class="token class-name static-context">Product</span><span class="token operator">::</span><span class="token function">whereYear</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;created_at&#39;</span><span class="token punctuation">,</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;Y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$products</span> <span class="token operator">=</span> <span class="token class-name static-context">Product</span><span class="token operator">::</span><span class="token function">whereTime</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;created_at&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;=&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;14:13:58&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="å¢å‡æŸä¸ªå­—æ®µ" tabindex="-1"><a class="header-anchor" href="#å¢å‡æŸä¸ªå­—æ®µ" aria-hidden="true">#</a> å¢å‡æŸä¸ªå­—æ®µ</h2><p>å¦‚æœæƒ³åœ¨æŸä¸ªè¡¨ä¸­å¢åŠ æŸåˆ—çš„æ•°å€¼ï¼Œåªéœ€ä½¿ç”¨ <code>increment()</code> å‡½æ•°ã€‚ å½“ç„¶ä¸ä»…å¯ä»¥å¢åŠ  <code>1</code>ï¼Œä¹Ÿå¯ä»¥å¢åŠ ä¸€äº›æ•°å­—ï¼Œæ¯”å¦‚ <code>50</code>ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$post_id</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;view_count&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$user_id</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;points&#39;</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># å‡å°‘å­—æ®µ points çš„å€¼</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="è¡¨ä¸å­˜åœ¨æ—¶é—´å­—æ®µ" tabindex="-1"><a class="header-anchor" href="#è¡¨ä¸å­˜åœ¨æ—¶é—´å­—æ®µ" aria-hidden="true">#</a> è¡¨ä¸å­˜åœ¨æ—¶é—´å­—æ®µ</h2><p>å¦‚æœæ•°æ®åº“è¡¨ä¸åŒ…å«æ—¶é—´æˆ³å­—æ®µ <code>created_at</code> å’Œ <code>updated_at</code>ï¼Œå¯ä»¥é€šè¿‡ <code>$timestamps = false</code> å±æ€§æŒ‡å®šæ¨¡å‹ä¸ä½¿ç”¨å®ƒä»¬ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">Company</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$timestamps</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="è½¯åˆ é™¤-å¤šæ¬¡è¿˜åŸ" tabindex="-1"><a class="header-anchor" href="#è½¯åˆ é™¤-å¤šæ¬¡è¿˜åŸ" aria-hidden="true">#</a> è½¯åˆ é™¤ï¼šå¤šæ¬¡è¿˜åŸ</h2><p>ä½¿ç”¨è½¯åˆ é™¤æ—¶ï¼Œä½¿ç”¨ <code>restore()</code> æ¢å¤å¤šè¡Œã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">onlyTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;author_id&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="all-æ–¹æ³•å€¼å®šè¿”å›å­—æ®µ" tabindex="-1"><a class="header-anchor" href="#all-æ–¹æ³•å€¼å®šè¿”å›å­—æ®µ" aria-hidden="true">#</a> <code>all</code> æ–¹æ³•å€¼å®šè¿”å›å­—æ®µ</h2><p>è°ƒç”¨æ¨¡å‹çš„ <code>Model::all()</code> æ—¶ï¼Œå¯ä»¥æŒ‡å®šè¦è¿”å›çš„åˆ—ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;id&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;email&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="æ˜¯å¦è¿”å›å¤±è´¥è¿˜æ˜¯æ¨¡å‹å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#æ˜¯å¦è¿”å›å¤±è´¥è¿˜æ˜¯æ¨¡å‹å®ä¾‹" aria-hidden="true">#</a> æ˜¯å¦è¿”å›å¤±è´¥è¿˜æ˜¯æ¨¡å‹å®ä¾‹</h2><p>é™¤äº† <code>findOrFail()</code>ï¼Œè¿˜æœ‰æ¨¡å‹æ–¹æ³• <code>firstOrFail()</code>ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°æŸ¥è¯¢è®°å½•ï¼Œä¼šè¿”å› 404 ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;email&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;test@exmple.com&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">firstOrFail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å¯ä»¥è°ƒç”¨ `firstOr()` å¯¹å¤±è´¥æ‰§è¡Œå…¶ä»–æ“ä½œ</span>
<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;email&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;test@example.com&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">firstOr</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="findorfail-æ–¹æ³•è¿˜æ¥å—ä¸»é”®æ•°ç»„" tabindex="-1"><a class="header-anchor" href="#findorfail-æ–¹æ³•è¿˜æ¥å—ä¸»é”®æ•°ç»„" aria-hidden="true">#</a> <code>findOrFail()</code> æ–¹æ³•è¿˜æ¥å—ä¸»é”®æ•°ç»„</h2><p><code>findOrFail()</code> æ–¹æ³•æ¥å—ä¸»é”®æ•°ç»„ã€‚å¦‚æœæœªæ‰¾åˆ°ä»»ä½•è¿™äº› idï¼Œåˆ™å®ƒâ€œå¤±è´¥â€ã€‚</p><p>å¦‚æœéœ€è¦æ£€ç´¢ä¸€ç»„ç‰¹å®šçš„æ¨¡å‹å¹¶ä¸”ä¸æƒ³æ£€æŸ¥æ‚¨è·å¾—çš„è®¡æ•°æ˜¯å¦æ˜¯æ‚¨é¢„æœŸçš„è®¡æ•°ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;id&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;id&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;id&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">findOrFail</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ£€ç´¢ç”¨æˆ·</span>

<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">findOrFail</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å› ä¸ºç”¨æˆ·ä¸å­˜åœ¨è€ŒæŠ›å‡º 404</span>

<span class="token variable">$users</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">findOrFail</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ£€ç´¢ä¸‰ä¸ªç”¨æˆ·</span>

<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">findOrFail</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æŠ›å‡ºå› ä¸ºå®ƒæ— æ³•æ‰¾åˆ° *all* çš„ç”¨æˆ·</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="ä¿®æ”¹æ•°æ®åº“å­—æ®µ" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹æ•°æ®åº“å­—æ®µ" aria-hidden="true">#</a> ä¿®æ”¹æ•°æ®åº“å­—æ®µ</h2><p>åœ¨æŸ¥è¯¢è¯­å¥ä¸­ï¼Œå¯ä»¥æŒ‡å®š <code>as</code> ä»¥è¿”å›å…·æœ‰ä¸åŒåç§°çš„ä»»ä½•åˆ—ï¼Œå°±åƒåœ¨æ™®é€š SQL æŸ¥è¯¢ä¸­ä¸€æ ·ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;users&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;email as user_email&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="æŸ¥è¯¢ç»“æœé›†ä½¿ç”¨mapå›è°ƒ" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢ç»“æœé›†ä½¿ç”¨mapå›è°ƒ" aria-hidden="true">#</a> æŸ¥è¯¢ç»“æœé›†ä½¿ç”¨mapå›è°ƒ</h2><p>åœ¨æ¨¡å‹æŸ¥è¯¢åï¼Œå¯ä»¥ä½¿ç”¨ <code>Collections</code> ä¸­çš„ <code>map()</code> å‡½æ•°æ¥ä¿®æ”¹è¡Œã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;role_id&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">User</span> <span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">some_column</span> <span class="token operator">=</span> <span class="token function">some_function</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$user</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="ä¿®æ”¹é»˜è®¤çš„æ—¶é—´å­—æ®µ" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹é»˜è®¤çš„æ—¶é—´å­—æ®µ" aria-hidden="true">#</a> ä¿®æ”¹é»˜è®¤çš„æ—¶é—´å­—æ®µ</h2><p>å¦‚æœä½¿ç”¨çš„æ˜¯é Laravel æ•°æ®åº“å¹¶ä¸”æ—¶é—´æˆ³åˆ—çš„åç§°ä¸åŒæ€ä¹ˆåŠï¼Ÿ æ¯”å¦‚ <code>create_time</code> å’Œ <code>update_time</code>ã€‚ å¯ä»¥åœ¨æ¨¡å‹ä¸­æŒ‡å®šå®ƒä»¬ï¼š</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token constant">CREATED_AT</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;create_time&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token constant">UPDATED_AT</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;update_time&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="é€šè¿‡æŸä¸ªå­—æ®µå¿«é€Ÿæ’åº" tabindex="-1"><a class="header-anchor" href="#é€šè¿‡æŸä¸ªå­—æ®µå¿«é€Ÿæ’åº" aria-hidden="true">#</a> é€šè¿‡æŸä¸ªå­—æ®µå¿«é€Ÿæ’åº</h2><p>é€šè¿‡ä½¿ç”¨ <code>latest()</code> å’Œ <code>oldest()</code> ä»£æ›¿ <code>-&gt;orderBy()</code>ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">latest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é™åºæ’åºï¼Œä»£æ›¿ -&gt;orderBy(&#39;created_at&#39;, &#39;desc&#39;)</span>
<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">oldest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å‡åºæ’åº</span>
<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">latest</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;updated_at&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æŒ‡å®šå­—æ®µï¼Œé™åºæ’åº</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="æ•°æ®åº“åŸå§‹æŸ¥è¯¢è®¡ç®—è¿è¡Œå¾—æ›´å¿«" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åº“åŸå§‹æŸ¥è¯¢è®¡ç®—è¿è¡Œå¾—æ›´å¿«" aria-hidden="true">#</a> æ•°æ®åº“åŸå§‹æŸ¥è¯¢è®¡ç®—è¿è¡Œå¾—æ›´å¿«</h2><p>ä½¿ç”¨ SQL åŸå§‹æŸ¥è¯¢ï¼Œå¦‚ <code>whereRaw()</code> æ–¹æ³•ï¼Œç›´æ¥åœ¨æŸ¥è¯¢ä¸­è¿›è¡Œä¸€äº›ç‰¹å®šäº <code>DB</code> çš„è®¡ç®—ï¼Œè€Œä¸æ˜¯åœ¨ <code>Laravel</code> ä¸­ï¼Œé€šå¸¸ç»“æœä¼šæ›´å¿«ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæƒ³è·å¾—æ³¨å†Œå 30 å¤©ä»¥ä¸Šä»å¤„äºæ´»è·ƒçŠ¶æ€çš„ç”¨æˆ·ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;active&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">whereRaw</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;TIMESTAMPDIFF(DAY, created_at, updated_at) &gt; ?&#39;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="å¤šä¸ª-scope-æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#å¤šä¸ª-scope-æŸ¥è¯¢" aria-hidden="true">#</a> å¤šä¸ª scope æŸ¥è¯¢</h2><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// æ¨¡å‹å®šä¹‰</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">scopeActive</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;active&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">scopeRegisteredWithinDays</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">,</span> <span class="token variable">$days</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;created_at&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;&gt;=&#39;</span><span class="token punctuation">,</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">subDays</span><span class="token punctuation">(</span><span class="token variable">$days</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä½¿ç”¨ </span>
<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">registeredWithinDays</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">active</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="æ— éœ€è½¬æ¢-carbon" tabindex="-1"><a class="header-anchor" href="#æ— éœ€è½¬æ¢-carbon" aria-hidden="true">#</a> æ— éœ€è½¬æ¢ carbon</h2><p>å¦‚æœæ­£åœ¨æ‰§è¡Œ <code>whereDate()</code> å¹¶æ£€ç´¢ä»Šå¤©çš„è®°å½•ï¼Œå¯ä»¥ä½¿ç”¨ Carbon çš„ <code>now()</code> ï¼Œå®ƒä¼šè‡ªåŠ¨è½¬æ¢ä¸ºæ—¥æœŸã€‚ æ— éœ€æ‰§è¡Œ <code>-&gt;toDateString()</code>ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// æ— éœ€å¯¹æ—¶é—´è¿›è¡Œè½¬æ¢ï¼Œç›´æ¥ä½¿ç”¨ `now()`</span>
<span class="token variable">$todayUsers</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">whereDate</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;created_at&#39;</span><span class="token punctuation">,</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="æŒ‰é¦–å­—æ¯åˆ†ç»„" tabindex="-1"><a class="header-anchor" href="#æŒ‰é¦–å­—æ¯åˆ†ç»„" aria-hidden="true">#</a> æŒ‰é¦–å­—æ¯åˆ†ç»„</h2><p>å¯ä»¥æŒ‰ä»»ä½•è‡ªå®šä¹‰æ¡ä»¶å¯¹ Eloquent ç»“æœè¿›è¡Œåˆ†ç»„ã€‚</p><p>ä»¥ä¸‹æ˜¯æŒ‰ç”¨æˆ·åçš„é¦–å­—æ¯åˆ†ç»„çš„æ–¹æ³•ï¼š</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$item</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="å­—æ®µä»…æ›´æ–°ä¸€æ¬¡" tabindex="-1"><a class="header-anchor" href="#å­—æ®µä»…æ›´æ–°ä¸€æ¬¡" aria-hidden="true">#</a> å­—æ®µä»…æ›´æ–°ä¸€æ¬¡</h2><p>å¦‚æœæœ‰ DB åˆ—ï¼Œåªæƒ³è®¾ç½®ä¸€æ¬¡å¹¶ä¸”ä¸å†æ›´æ–°ï¼Œå¯ä»¥ä½¿ç”¨ mutator å¯¹ Eloquent æ¨¡å‹è®¾ç½®è¯¥é™åˆ¶ï¼š</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">setEmailAttribute</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">email</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">attributes</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;email&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="find-æ–¹æ³•é’ˆå¯¹ä¸»é”®æŸ¥è¯¢æ›´å¤š" tabindex="-1"><a class="header-anchor" href="#find-æ–¹æ³•é’ˆå¯¹ä¸»é”®æŸ¥è¯¢æ›´å¤š" aria-hidden="true">#</a> find æ–¹æ³•é’ˆå¯¹ä¸»é”®æŸ¥è¯¢æ›´å¤š</h2><p>æ¨¡å‹æ–¹æ³• <code>find()</code> å¯ä»¥æ¥å—å¤šä¸ªæ•°ç»„å‚æ•°ï¼Œç„¶åå®ƒè¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ‰¾åˆ°çš„è®°å½•çš„é›†åˆï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ¨¡å‹å®ä¾‹ï¼š</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿”å›æ¨¡å‹å®ä¾‹</span>
<span class="token variable">$users</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿”å›æ¨¡å‹é›†åˆ</span>

<span class="token variable">$users</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;first_name&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;email&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æŒ‡å®šè¿”å›çš„æ¨¡å‹é›†åˆä¸­çš„å¯¹åº”å­—æ®µ</span>

<span class="token comment">// é€šè¿‡æ¨¡å‹ä¸»é”®æŸ¥è¯¢å¯ä»¥é€šè¿‡ `-&gt;whereKey()` æ–¹æ³•</span>
<span class="token variable">$users</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">whereKey</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="ä½¿ç”¨uuidä»£æ›¿ä¸»é”®è‡ªå¢" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨uuidä»£æ›¿ä¸»é”®è‡ªå¢" aria-hidden="true">#</a> ä½¿ç”¨UUIDä»£æ›¿ä¸»é”®è‡ªå¢</h2><p>åœ¨æ¨¡å‹ä¸­ä¸å¸Œæœ›ä½¿ç”¨ä¸»é”®è‡ªå¢ï¼Ÿå¯ä»¥ä½¿ç”¨UUIDä»£æ›¿ï¼š</p><ul><li>è¿ç§»æ–‡ä»¶</li></ul><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">Schema</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;users&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Blueprint</span> <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// $table-&gt;increments(&#39;id&#39;);</span>
    <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;id&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>æ¨¡å‹å®šä¹‰</li></ul><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$incrementing</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$keyType</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;string&#39;</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">creating</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$model</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$model</span><span class="token operator">-&gt;</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">setId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">attributes</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;id&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name static-context">Str</span><span class="token operator">::</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="å­æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#å­æŸ¥è¯¢" aria-hidden="true">#</a> å­æŸ¥è¯¢</h2><p>ä» Laravel 6 å¼€å§‹ï¼Œå¯ä»¥åœ¨æ¨¡å‹è¯­å¥ä¸­ä½¿ç”¨ <code>addSelect()</code>ï¼Œå¹¶å¯¹æ·»åŠ çš„åˆ—è¿›è¡Œä¸€äº›è®¡ç®—ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token class-name static-context">Destination</span><span class="token operator">::</span><span class="token function">addSelect</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;last_flight&#39;</span> <span class="token operator">=&gt;</span> <span class="token class-name static-context">Flight</span><span class="token operator">::</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;name&#39;</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">whereColumn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;destination_id&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;destinations.id&#39;</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;arrived_at&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;desc&#39;</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="éšè—ä¸€äº›å­—æ®µ" tabindex="-1"><a class="header-anchor" href="#éšè—ä¸€äº›å­—æ®µ" aria-hidden="true">#</a> éšè—ä¸€äº›å­—æ®µ</h2><p>åœ¨è¿›è¡Œæ¨¡å‹æŸ¥è¯¢æ—¶ï¼Œå¦‚æœè¦éšè—ç‰¹å®šå­—æ®µä¸è¢«è¿”å›ï¼Œæœ€å¿«çš„æ–¹æ³•ä¹‹ä¸€æ˜¯åœ¨ Collection ç»“æœä¸Šæ·»åŠ  <code>-&gt;makeHidden()</code>ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">makeHidden</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;email_verified_at&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;deleted_at&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æˆ–è€…åœ¨æ¨¡å‹ä¸­å®šä¹‰</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Authenticatable</span> 
<span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">protected</span> <span class="token variable">$hidden</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">&#39;email_verified_at&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;deleted_at&#39;</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="æ•æ‰æ•°æ®åº“é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#æ•æ‰æ•°æ®åº“é”™è¯¯" aria-hidden="true">#</a> æ•æ‰æ•°æ®åº“é”™è¯¯</h2><p>å¦‚æœè¦æ•è·æ¨¡å‹æŸ¥è¯¢å¼‚å¸¸ï¼Œè¯·ä½¿ç”¨ç‰¹å®šçš„ <code>QueryException</code> è€Œä¸æ˜¯é»˜è®¤çš„ <code>Exception</code> ç±»ï¼Œå°†èƒ½å¤Ÿè·å¾—é”™è¯¯çš„ç¡®åˆ‡ SQL ä»£ç ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// Some Eloquent/SQL statement</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>QueryException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string single-quoted-string">&#39;23000&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// integrity constraint violation</span>
        <span class="token keyword">return</span> <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">withError</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;Invalid data&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="æŸ¥è¯¢ç”Ÿæˆ-è½¯åˆ é™¤" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢ç”Ÿæˆ-è½¯åˆ é™¤" aria-hidden="true">#</a> æŸ¥è¯¢ç”Ÿæˆ - è½¯åˆ é™¤</h2><p>ä¸è¦å¿˜è®°ï¼Œå½“ä½¿ç”¨æ¨¡å‹æ—¶ï¼Œè½¯åˆ é™¤ä¼šæ’é™¤æ¡ç›®ï¼Œä½†å¦‚æœæ‚¨ä½¿ç”¨ Query Builderï¼Œåˆ™ä¸ä¼šèµ·ä½œç”¨ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†ä¸åŒ…å«å·²åˆ é™¤çš„é¡¹</span>
<span class="token variable">$users</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">withTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åŒ…å«å·²åˆ é™¤çš„é¡¹</span>

<span class="token variable">$users</span> <span class="token operator">=</span> <span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;users&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åŒ…å«å·²åˆ é™¤çš„é¡¹</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="sql-æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#sql-æŸ¥è¯¢" aria-hidden="true">#</a> SQL æŸ¥è¯¢</h2><p>å¦‚æœéœ€è¦æ‰§è¡Œä¸€ä¸ªç®€å•çš„ SQL æŸ¥è¯¢ï¼Œä½†æ²¡æœ‰å¾—åˆ°ä»»ä½•ç»“æœâ€”â€”æ¯”å¦‚æ›´æ”¹ DB æ¨¡å¼ä¸­çš„æŸäº›å†…å®¹ï¼Œå¯ä»¥æ‰§è¡Œ <code>DB::statement()</code>ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">statement</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;DROP TABLE users&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">statement</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;ALTER TABLE projects AUTO_INCREMENT=123&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="ä½¿ç”¨dbäº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨dbäº‹åŠ¡" aria-hidden="true">#</a> ä½¿ç”¨DBäº‹åŠ¡</h2><p>å¦‚æœæ‰§è¡Œäº†ä¸¤ä¸ªæ•°æ®åº“æ“ä½œï¼Œç¬¬äºŒä¸ªå¯èƒ½ä¼šå‡ºé”™ï¼Œé‚£ä¹ˆåº”è¯¥å›æ»šç¬¬ä¸€ä¸ªã€‚ ä¸ºæ­¤ï¼Œå»ºè®®ä½¿ç”¨ DB äº‹åŠ¡ï¼š</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;users&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;votes&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;posts&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="æ›´æ–°æˆ–åˆ›å»º" tabindex="-1"><a class="header-anchor" href="#æ›´æ–°æˆ–åˆ›å»º" aria-hidden="true">#</a> æ›´æ–°æˆ–åˆ›å»º</h2><p>å¦‚æœéœ€è¦æ£€æŸ¥è®°å½•æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™æ›´æ–°å®ƒï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºä¸€ä¸ªæ–°è®°å½•ã€‚ ä½¿ç”¨æ¨¡å‹çš„ <code>updateOrCreate()</code> æ–¹æ³•ï¼š</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$flight</span> <span class="token operator">=</span> <span class="token class-name static-context">Flight</span><span class="token operator">::</span><span class="token function">updateOrCreate</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;departure&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;Oakland&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;destination&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;San Diego&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// æ¡ä»¶</span>
    <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;price&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;discounted&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="æ›´æ”¹æ—¥æœŸæ ¼å¼" tabindex="-1"><a class="header-anchor" href="#æ›´æ”¹æ—¥æœŸæ ¼å¼" aria-hidden="true">#</a> æ›´æ”¹æ—¥æœŸæ ¼å¼</h2><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// æ¨¡å‹å®šä¹‰</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getCreatedAtFormattedAttribute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">created_at</span><span class="token operator">-&gt;</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;H:i d, M Y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getUpdatedAtFormattedAttribute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">updated_at</span><span class="token operator">-&gt;</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;H:i d, M Y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä½¿ç”¨</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">created_at_formatted</span><span class="token punctuation">;</span> <span class="token comment">// `12:25 18, Jan 2021`</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="åœ¨jsonå­—æ®µä¸­å­˜å‚¨æ•°ç»„" tabindex="-1"><a class="header-anchor" href="#åœ¨jsonå­—æ®µä¸­å­˜å‚¨æ•°ç»„" aria-hidden="true">#</a> åœ¨JSONå­—æ®µä¸­å­˜å‚¨æ•°ç»„</h2><p>å¦‚æœè¾“å…¥å­—æ®µéœ€è¦ä¸€ä¸ªæ•°ç»„å¹¶ä¸”å¿…é¡»å°†å…¶å­˜å‚¨ä¸º JSONï¼Œå¯ä»¥åœ¨æ¨¡å‹ä¸­ä½¿ç”¨ <code>$casts</code> å±æ€§ã€‚è¿™é‡Œçš„ <code>images</code> æ˜¯ä¸€ä¸ª <code>JSON</code> å±æ€§ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// æ¨¡å‹å®šä¹‰</span>
<span class="token keyword">protected</span> <span class="token variable">$casts</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">&#39;images&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;array&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="æ¨¡å‹çš„å‰¯æœ¬" tabindex="-1"><a class="header-anchor" href="#æ¨¡å‹çš„å‰¯æœ¬" aria-hidden="true">#</a> æ¨¡å‹çš„å‰¯æœ¬</h2><p>å¦‚æœæœ‰ä¸¤ä¸ªéå¸¸ç›¸ä¼¼çš„æ¨¡å‹ï¼ˆä¾‹å¦‚é€è´§åœ°å€å’Œå¸å•åœ°å€ï¼‰ï¼Œå¹¶ä¸”éœ€è¦å°†ä¸€ä¸ªå¤åˆ¶åˆ°å¦ä¸€ä¸ªï¼Œå¯ä»¥ä½¿ç”¨ <code>replicate()</code> æ–¹æ³•å¹¶åœ¨æ­¤ä¹‹åæ›´æ”¹ä¸€äº›å±æ€§ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$shipping</span> <span class="token operator">=</span> <span class="token class-name static-context">Address</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string single-quoted-string">&#39;type&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;shipping&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;line_1&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;123 Example Street&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;city&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;Victorville&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;state&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;CA&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;postcode&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;90001&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$billing</span> <span class="token operator">=</span> <span class="token variable">$shipping</span><span class="token operator">-&gt;</span><span class="token function">replicate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string single-quoted-string">&#39;type&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;billing&#39;</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$billing</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="åˆ é™¤æ¨¡å‹ä¹‹å‰æ‰§è¡Œä»»ä½•é¢å¤–æ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#åˆ é™¤æ¨¡å‹ä¹‹å‰æ‰§è¡Œä»»ä½•é¢å¤–æ­¥éª¤" aria-hidden="true">#</a> åˆ é™¤æ¨¡å‹ä¹‹å‰æ‰§è¡Œä»»ä½•é¢å¤–æ­¥éª¤</h2><p>å¯ä»¥åœ¨é‡å†™çš„åˆ é™¤æ–¹æ³•ä¸­ä½¿ç”¨ <code>Model::delete()</code> æ¥æ‰§è¡Œé¢å¤–çš„æ­¥éª¤ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// App\Models\User.php</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token comment">// è¿™é‡Œæœ‰é¢å¤–çš„æ­¥éª¤ï¼Œæ— è®ºä½ æƒ³è¦ä»€ä¹ˆ</span>

    <span class="token class-name static-context">Model</span><span class="token operator">::</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç°åœ¨æ‰§è¡Œæ­£å¸¸åˆ é™¤</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="å°†æ•°æ®æŒä¹…åŒ–åˆ°æ•°æ®åº“æ—¶è‡ªåŠ¨å¡«å……åˆ—" tabindex="-1"><a class="header-anchor" href="#å°†æ•°æ®æŒä¹…åŒ–åˆ°æ•°æ®åº“æ—¶è‡ªåŠ¨å¡«å……åˆ—" aria-hidden="true">#</a> å°†æ•°æ®æŒä¹…åŒ–åˆ°æ•°æ®åº“æ—¶è‡ªåŠ¨å¡«å……åˆ—</h2><p>å¦‚æœå°†æ•°æ®æŒä¹…åŒ–åˆ°æ•°æ®åº“æ—¶è‡ªåŠ¨å¡«å……ä¸€åˆ—ï¼ˆä¾‹å¦‚ï¼š<code>slug</code>ï¼‰ï¼Œè¯·ä½¿ç”¨æ¨¡å‹ç›‘å¬è€…è€Œä¸æ˜¯æ¯æ¬¡éƒ½å¯¹å…¶è¿›è¡Œç¡¬ç¼–ç ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Str</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Article</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword static-context">static</span><span class="token operator">::</span><span class="token function">saving</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$model</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$model</span><span class="token operator">-&gt;</span><span class="token property">slug</span> <span class="token operator">=</span> <span class="token class-name static-context">Str</span><span class="token operator">::</span><span class="token function">slug</span><span class="token punctuation">(</span><span class="token variable">$model</span><span class="token operator">-&gt;</span><span class="token property">title</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="åˆ†ææŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#åˆ†ææŸ¥è¯¢" aria-hidden="true">#</a> åˆ†ææŸ¥è¯¢</h2><p>å¯ä»¥åœ¨æŸ¥è¯¢ä¸Šè°ƒç”¨ <code>explain()</code> æ–¹æ³•æ¥äº†è§£æœ‰å…³æŸ¥è¯¢çš„é¢å¤–ä¿¡æ¯ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">Book</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;Ruskin Bond&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">explain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">dd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åƒä¸‹é¢è¿™æ ·</span>
Illuminate\Support\Collection <span class="token punctuation">{</span><span class="token comment">#5344</span>
    all<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token comment">#15407</span>
            <span class="token operator">+</span><span class="token string double-quoted-string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token operator">+</span><span class="token string double-quoted-string">&quot;select_type&quot;</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;SIMPLE&quot;</span><span class="token punctuation">,</span>
            <span class="token operator">+</span><span class="token string double-quoted-string">&quot;table&quot;</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;books&quot;</span><span class="token punctuation">,</span>
            <span class="token operator">+</span><span class="token string double-quoted-string">&quot;partitions&quot;</span><span class="token punctuation">:</span> <span class="token constant">null</span><span class="token punctuation">,</span>
            <span class="token operator">+</span><span class="token string double-quoted-string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;ALL&quot;</span><span class="token punctuation">,</span>
            <span class="token operator">+</span><span class="token string double-quoted-string">&quot;possible_keys&quot;</span><span class="token punctuation">:</span> <span class="token constant">null</span><span class="token punctuation">,</span>
            <span class="token operator">+</span><span class="token string double-quoted-string">&quot;key&quot;</span><span class="token punctuation">:</span> <span class="token constant">null</span><span class="token punctuation">,</span>
            <span class="token operator">+</span><span class="token string double-quoted-string">&quot;key_len&quot;</span><span class="token punctuation">:</span> <span class="token constant">null</span><span class="token punctuation">,</span>
            <span class="token operator">+</span><span class="token string double-quoted-string">&quot;ref&quot;</span><span class="token punctuation">:</span> <span class="token constant">null</span><span class="token punctuation">,</span>
            <span class="token operator">+</span><span class="token string double-quoted-string">&quot;rows&quot;</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
            <span class="token operator">+</span><span class="token string double-quoted-string">&quot;filtered&quot;</span><span class="token punctuation">:</span> <span class="token number">11.11111164093</span><span class="token punctuation">,</span>
            <span class="token operator">+</span><span class="token string double-quoted-string">&quot;Extra&quot;</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;Using where&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="dontexist-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#dontexist-æ–¹æ³•" aria-hidden="true">#</a> <code>dontExist()</code> æ–¹æ³•</h2><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">0</span> <span class="token operator">===</span> <span class="token variable">$model</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;status&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;pending&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä½†æ˜¯ç”±äºæˆ‘ä¸å…³å¿ƒæ€»æ•°ï¼Œ`exists()` æ–¹æ³•æ›´ç®€æ´ã€‚</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token variable">$model</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;status&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;pending&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token comment">// `doesntExist()` æ–¹æ³•ä½¿ä¹‹æ›´åŠ ç®€æ´</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$model</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;status&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;pending&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">doesntExist</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="æ·»åŠ æ¨¡å‹çš„traitä¸”è‡ªåŠ¨è°ƒç”¨å®ƒä»¬çš„-boot-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#æ·»åŠ æ¨¡å‹çš„traitä¸”è‡ªåŠ¨è°ƒç”¨å®ƒä»¬çš„-boot-æ–¹æ³•" aria-hidden="true">#</a> æ·»åŠ æ¨¡å‹çš„Traitä¸”è‡ªåŠ¨è°ƒç”¨å®ƒä»¬çš„ <code>boot()</code> æ–¹æ³•</h2><p>å¦‚æœæœ‰ä¸€ä¸ª Trait æƒ³è¦æ·»åŠ åˆ°å‡ ä¸ªæ¨¡å‹ä¸­ä»¥è‡ªåŠ¨è°ƒç”¨å®ƒä»¬çš„ <code>boot()</code> æ–¹æ³•ï¼Œå¯ä»¥åœ¨ <code>Trait</code> ä¸­ç¼–å†™é™æ€æ–¹æ³• boot[TraitName]ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// Transaction æ¨¡å‹</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Transaction</span> <span class="token keyword">extends</span>  <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">MultiTenantModelTrait</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Task æ¨¡å‹</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Task</span> <span class="token keyword">extends</span>  <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">MultiTenantModelTrait</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// MultiTenantModelTrait Trait</span>
<span class="token keyword">trait</span> <span class="token class-name-definition class-name">MultiTenantModelTrait</span>
<span class="token punctuation">{</span>
    <span class="token comment">// This method&#39;s name is boot[TraitName]</span>
    <span class="token comment">// It will be auto-called as boot() of Transaction/Task</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">bootMultiTenantModelTrait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword static-context">static</span><span class="token operator">::</span><span class="token function">creating</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$model</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$isAdmin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$isAdmin</span><span class="token operator">-&gt;</span><span class="token property">created_by_id</span> <span class="token operator">=</span> <span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="å¦‚ä½•é˜²æ­¢-éå¯¹è±¡å±æ€§-é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•é˜²æ­¢-éå¯¹è±¡å±æ€§-é”™è¯¯" aria-hidden="true">#</a> å¦‚ä½•é˜²æ­¢â€œéå¯¹è±¡å±æ€§â€é”™è¯¯</h2><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// å¦‚æœæ²¡æœ‰ä½œè€…é™„åŠ åˆ°å¸–å­ï¼Œè¿™ä¸ªå…³ç³»å°†è¿”å›ä¸€ä¸ªç©ºçš„ `App\Author` æ¨¡å‹</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">author</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;App\Author&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">withDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// or</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">author</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;App\Author&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">withDefault</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token string single-quoted-string">&#39;name&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;Guest Author&#39;</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä»£ç è°ƒç”¨</span>
<span class="token variable">$post</span><span class="token operator">-&gt;</span><span class="token property">author</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="ä¿®æ”¹æ¨¡å‹è®°å½•åè·å–åŸå§‹å±æ€§-getoriginal" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹æ¨¡å‹è®°å½•åè·å–åŸå§‹å±æ€§-getoriginal" aria-hidden="true">#</a> ä¿®æ”¹æ¨¡å‹è®°å½•åè·å–åŸå§‹å±æ€§ <code>getOriginal()</code></h2><p>ä¿®æ”¹æ¨¡å‹è®°å½•åè·å–åŸå§‹å±æ€§ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ <code>getOriginal()</code> è·å–åŸå§‹å±æ€§ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">;</span> <span class="token comment">// John</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;Peter&quot;</span><span class="token punctuation">;</span> <span class="token comment">// Peter</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">getOriginal</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// John</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">getOriginal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Original $user record</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="å¡«å……æ•°æ®åº“çš„ç®€å•æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#å¡«å……æ•°æ®åº“çš„ç®€å•æ–¹æ³•" aria-hidden="true">#</a> å¡«å……æ•°æ®åº“çš„ç®€å•æ–¹æ³•</h2><p>ä½¿ç”¨ .sql è½¬å‚¨æ–‡ä»¶æ’­ç§æ•°æ®åº“çš„ç®€å•æ–¹æ³•ã€‚å‡å¦‚å­˜åœ¨ <code>dump.sql</code>ï¼š</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">unprepared</span><span class="token punctuation">(</span>
    <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token constant">__DIR__</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39;./dump.sql&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="æŒ‰ä¸­é—´è¡¨å­—æ®µæ’åº" tabindex="-1"><a class="header-anchor" href="#æŒ‰ä¸­é—´è¡¨å­—æ®µæ’åº" aria-hidden="true">#</a> æŒ‰ä¸­é—´è¡¨å­—æ®µæ’åº</h2><p><code>BelongsToMany::orderByPivot()</code> å…è®¸ç›´æ¥å¯¹ BelongsToMany å…³ç³»æŸ¥è¯¢çš„ç»“æœè¿›è¡Œæ’åºã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">Tag</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;tags&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Post</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;posts&#39;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">tags</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span><span class="token class-name static-context">Tag</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;post_tag&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;post_id&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;tag_id&#39;</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">using</span><span class="token punctuation">(</span><span class="token class-name static-context">PostTagPivot</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">withTimestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">withPivot</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;flag&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">PostTagPivot</span> <span class="token keyword">extends</span> <span class="token class-name">Pivot</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;post_tag&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// è°ƒç”¨</span>
<span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">findOrFail</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">tags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">orderByPivot</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;flag&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;desc&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="æŸ¥æ‰¾å•ä¸ªè®°å½•" tabindex="-1"><a class="header-anchor" href="#æŸ¥æ‰¾å•ä¸ªè®°å½•" aria-hidden="true">#</a> æŸ¥æ‰¾å•ä¸ªè®°å½•</h2><p><code>sole()</code> æ–¹æ³•å°†åªè¿”å›ä¸€æ¡ç¬¦åˆæ¡ä»¶çš„è®°å½•ã€‚</p><ul><li><p>å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¿™æ ·çš„æ¡ç›®ï¼Œåˆ™ä¼šæŠ›å‡º <code>NoRecordsFoundException</code>ã€‚</p></li><li><p>å¦‚æœæ‰¾åˆ°å¤šæ¡è®°å½•ï¼Œåˆ™ä¼šæŠ›å‡º <code>MultipleRecordsFoundException</code>ã€‚</p></li></ul><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;products&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;ref&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;#123&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">sole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="chuckmap-å¤„ç†ç»“æœ" tabindex="-1"><a class="header-anchor" href="#chuckmap-å¤„ç†ç»“æœ" aria-hidden="true">#</a> chuckMap å¤„ç†ç»“æœ</h2><p>ç±»ä¼¼äº <code>each()</code> æ–¹æ³•ï¼Œä½†æ›´æ˜“äºä½¿ç”¨ã€‚è‡ªåŠ¨å°†ç»“æœæ‹†åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼ˆå—ï¼‰ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;name&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">chunkMap</span><span class="token punctuation">(</span><span class="token keyword">fn</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">&#39;id&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;name&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="æ›´æ–°æ¨¡å‹ä½†ä¸è§¦å‘äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#æ›´æ–°æ¨¡å‹ä½†ä¸è§¦å‘äº‹ä»¶" aria-hidden="true">#</a> æ›´æ–°æ¨¡å‹ä½†ä¸è§¦å‘äº‹ä»¶</h2><p>æœ‰æ—¶éœ€è¦åœ¨ä¸å‘é€ä»»ä½•äº‹ä»¶çš„æƒ…å†µä¸‹æ›´æ–°æ¨¡å‹ã€‚ç°åœ¨å¯ä»¥ä½¿ç”¨ <code>updateQuietly()</code> æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œè¯¥æ–¹æ³•åœ¨èƒŒåä½¿ç”¨ <code>saveQuietly()</code> æ–¹æ³•ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$flight</span><span class="token operator">-&gt;</span><span class="token function">updateQuietly</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;departed&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="å®šæœŸæ¸…ç†è¿‡æ—¶è®°å½•ä¸­çš„æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#å®šæœŸæ¸…ç†è¿‡æ—¶è®°å½•ä¸­çš„æ¨¡å‹" aria-hidden="true">#</a> å®šæœŸæ¸…ç†è¿‡æ—¶è®°å½•ä¸­çš„æ¨¡å‹</h2><p>æœ‰äº†è¿™ä¸ªç‰¹æ€§ï¼ŒLaravelä¼šè‡ªåŠ¨æ‰§è¡Œæ­¤æ“ä½œï¼Œåªéœ€è¦åœ¨ Kernel ç±»ä¸­è°ƒæ•´ <code>model:prune</code> å‘½ä»¤çš„é¢‘ç‡å³å¯ã€‚</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">æ¨¡å‹å®šä¹‰</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">å®šæ—¶ä»»åŠ¡</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Prunable</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Flight</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">Prunable</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * Get the prunable model query.
     *
     * <span class="token keyword">@return</span> <span class="token class-name"><span class="token punctuation">\</span>Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Builder</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">prunable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword static-context">static</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;created_at&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;&amp;lt;=&#39;</span><span class="token punctuation">,</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">subMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// æ­¤å¤–ï¼Œå¯ä»¥è®¾ç½®åœ¨åˆ é™¤æ¨¡å‹ä¹‹å‰å¿…é¡»æ‰§è¡Œçš„æ“ä½œï¼š</span>
    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">pruning</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// åˆ é™¤å…³è”èµ„æºï¼Œä¾‹å¦‚æ–‡ä»¶</span>
        <span class="token class-name static-context">Storage</span><span class="token operator">::</span><span class="token function">disk</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;s3&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// App\Console\Kernel.php</span>
<span class="token doc-comment comment">/**
 * Define the application&#39;s command schedule.
 *
 * <span class="token keyword">@param</span>  <span class="token class-name"><span class="token punctuation">\</span>Illuminate<span class="token punctuation">\</span>Console<span class="token punctuation">\</span>Scheduling<span class="token punctuation">\</span>Schedule</span>  <span class="token parameter">$schedule</span>
 * <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">void</span></span>
 */</span>
<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">schedule</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Schedule</span> <span class="token variable">$schedule</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$schedule</span><span class="token operator">-&gt;</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;model:prune&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">daily</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// $schedule-&gt;command(&#39;model:prune&#39;, [&#39;--model&#39; =&gt; [Address::class, Flight::class]])-&gt;daily(); // æŒ‡å®šç‰¹å®šæ¨¡å‹å‚æ•°</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><!--]--></div><!--]--></div><h2 id="ä¸å¯å˜çš„æ—¥æœŸ" tabindex="-1"><a class="header-anchor" href="#ä¸å¯å˜çš„æ—¥æœŸ" aria-hidden="true">#</a> ä¸å¯å˜çš„æ—¥æœŸ</h2><p><code>Laravel 8.53</code> å¼•å…¥äº†å°†æ—¥æœŸè½¬æ¢ä¸ºä¸å¯å˜çš„ <code>immutable_date</code> å’Œ <code>immutable_datetime</code> ç§å§“ã€‚</p><p>è½¬æ¢ä¸º <code>CarbonImmutable</code> è€Œä¸æ˜¯å¸¸è§„çš„ <code>Carbon</code> å®ä¾‹ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$casts</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">&#39;date_field&#39;</span>     <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;immutable_date&#39;</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;datetime_field&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;immutable_datetime&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="withaggregate-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#withaggregate-æ–¹æ³•" aria-hidden="true">#</a> <code>withAggregate</code> æ–¹æ³•</h2><p>åœ¨åº•å±‚ï¼Œæ¨¡å‹ä¸­çš„ <code>withAvg</code>/<code>withCount</code>/<code>withSum</code> å’Œå…¶ä»–æ–¹æ³•ä½¿ç”¨äº† <code>withAggregate</code> æ–¹æ³•ã€‚</p><p>å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•æ·»åŠ åŸºäºå…³ç³»çš„å­é€‰æ‹©</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// æ¨¡å‹ Post</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Post</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token variable">$posts</span> <span class="token operator">=</span> <span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;user&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æƒ°æ€§åŠ è½½æ‰€æœ‰ç”¨æˆ·</span>

<span class="token variable">$posts</span> <span class="token operator">=</span> <span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">withAggregate</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;name&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯ä»¥æ·»åŠ å­é€‰æ‹©ä»¥ä»…æ£€ç´¢ç”¨æˆ·å</span>

<span class="token variable">$posts</span><span class="token operator">-&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">user_name</span><span class="token punctuation">;</span> <span class="token comment">// å°†ä¸º Post å®ä¾‹æ·»åŠ ä¸€ä¸ª &#39;user_name&#39; å±æ€§</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="upsert-æ–¹æ³•æ’å…¥æˆ–æ›´æ–°å¤šæ¡è®°å½•" tabindex="-1"><a class="header-anchor" href="#upsert-æ–¹æ³•æ’å…¥æˆ–æ›´æ–°å¤šæ¡è®°å½•" aria-hidden="true">#</a> <code>upsert()</code> æ–¹æ³•æ’å…¥æˆ–æ›´æ–°å¤šæ¡è®°å½•</h2><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">Flight</span><span class="token operator">::</span><span class="token function">upsert</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span>
        <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;departure&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;Oakland&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;destination&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;San Diego&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;price&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">99</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;departure&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;Chicago&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;destination&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;New York&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;price&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">150</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;departure&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;destination&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
    <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;price&#39;</span><span class="token punctuation">]</span>
 <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>ç¬¬ä¸€ä¸ªæ•°ç»„ï¼šè¦æ’å…¥æˆ–æ›´æ–°çš„å€¼</li><li>ç¬¬äºŒä¸ªæ•°ç»„ï¼šselectè¯­å¥ä¸­ä½¿ç”¨çš„å”¯ä¸€æ ‡è¯†ç¬¦åˆ—</li><li>ç¬¬ä¸‰ä¸ªæ•°ç»„ï¼šå¦‚æœè®°å½•å­˜åœ¨åˆ™è¦æ›´æ–°çš„åˆ—</li></ul><h2 id="è¿‡æ»¤ç»“æœåæ£€ç´¢æŸ¥è¯¢ç”Ÿæˆå™¨" tabindex="-1"><a class="header-anchor" href="#è¿‡æ»¤ç»“æœåæ£€ç´¢æŸ¥è¯¢ç”Ÿæˆå™¨" aria-hidden="true">#</a> è¿‡æ»¤ç»“æœåæ£€ç´¢æŸ¥è¯¢ç”Ÿæˆå™¨</h2><p>è¦åœ¨è¿‡æ»¤ç»“æœåæ£€ç´¢æŸ¥è¯¢ç”Ÿæˆå™¨ï¼šæ‚¨å¯ä»¥ä½¿ç”¨ <code>-&gt;toQuery()</code>ã€‚ è¯¥æ–¹æ³•åœ¨å†…éƒ¨ä½¿ç”¨é›†åˆçš„ç¬¬ä¸€ä¸ªæ¨¡å‹å’Œé›†åˆæ¨¡å‹ä¸Šçš„ <code>whereKey</code> æ¯”è¾ƒã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$loggedInUsers</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;logged_in&#39;</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ£€ç´¢æ‰€æœ‰å·²ç™»å½•çš„ç”¨æˆ·</span>

<span class="token variable">$nthUsers</span> <span class="token operator">=</span> <span class="token variable">$loggedInUsers</span><span class="token operator">-&gt;</span><span class="token function">nth</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä½¿ç”¨ Collection æ–¹æ³•æˆ– php è¿‡æ»¤è¿‡æ»¤å®ƒä»¬</span>

<span class="token variable">$nthUsers</span><span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸èƒ½åœ¨é›†åˆä¸Šæ‰§è¡Œæ­¤æ“ä½œ</span>

<span class="token comment">// ä½†æ˜¯å¯ä»¥ä½¿ç”¨ `-&gt;toQuery()` æ£€ç´¢ Builder</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$nthUsers</span><span class="token operator">-&gt;</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$nthUsers</span><span class="token operator">-&gt;</span><span class="token function">toQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="è‡ªå®šæœ‰æ•°æ®è½¬æ¢" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šæœ‰æ•°æ®è½¬æ¢" aria-hidden="true">#</a> è‡ªå®šæœ‰æ•°æ®è½¬æ¢</h2><p>å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰è½¬æ¢æ¥è‡ªåŠ¨æ ¼å¼åŒ–æ¨¡å‹æ•°æ®ã€‚å¦‚ä¸‹æ£€ç´¢æˆ–æ›´æ”¹ç”¨æˆ·åæ—¶å°†å…¶å¤§å†™çš„ç¤ºä¾‹ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">CapitalizeWordsCast</span> <span class="token keyword">implements</span> <span class="token class-name">CastsAttributes</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">get</span><span class="token punctuation">(</span><span class="token variable">$model</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$attributes</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">ucwords</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">set</span><span class="token punctuation">(</span><span class="token variable">$model</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$attributes</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">ucwords</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä½¿ç”¨</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$casts</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">&#39;name&#39;</span>  <span class="token operator">=&gt;</span> <span class="token class-name static-context">CapitalizeWordsCast</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;email&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;string&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="æ ¹æ®ç›¸å…³æ¨¡å‹çš„å¹³å‡å€¼æˆ–è®¡æ•°æ’åº" tabindex="-1"><a class="header-anchor" href="#æ ¹æ®ç›¸å…³æ¨¡å‹çš„å¹³å‡å€¼æˆ–è®¡æ•°æ’åº" aria-hidden="true">#</a> æ ¹æ®ç›¸å…³æ¨¡å‹çš„å¹³å‡å€¼æˆ–è®¡æ•°æ’åº</h2><p>æ˜¯å¦æ›¾ç»éœ€è¦æ ¹æ®ç›¸å…³å‹å·çš„å¹³å‡å€¼æˆ–è®¡æ•°è¿›è¡Œæ’åº</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">bestBooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name static-context">Book</span><span class="token operator">::</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">withAvg</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;ratings as average_rating&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;rating&#39;</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">orderByDesc</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;average_rating&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="è¿”å›äº‹åŠ¡ç»“æœ" tabindex="-1"><a class="header-anchor" href="#è¿”å›äº‹åŠ¡ç»“æœ" aria-hidden="true">#</a> è¿”å›äº‹åŠ¡ç»“æœ</h2><p>å¦‚æœæœ‰ä¸€ä¸ª DB äº‹åŠ¡ï¼Œæƒ³è¦è¿”å›å®ƒçš„ç»“æœï¼Œè‡³å°‘æœ‰ä¸¤ç§æ–¹å¼ï¼Œçœ‹ä¾‹å­ï¼š</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// 1. å¯ä»¥é€šè¿‡å¼•ç”¨ä¼ é€’å‚æ•°</span>
<span class="token variable">$invoice</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$invoice</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$invoice</span> <span class="token operator">=</span> <span class="token class-name static-context">Invoice</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$invoice</span><span class="token operator">-&gt;</span><span class="token function">items</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 2. æˆ–æ›´çŸ­ï¼šåªè¿”å›äº‹åŠ¡ç»“æœ</span>
<span class="token variable">$invoice</span> <span class="token operator">=</span> <span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$invoice</span> <span class="token operator">=</span> <span class="token class-name static-context">Invoice</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$invoice</span><span class="token operator">-&gt;</span><span class="token function">items</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token variable">$invoice</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="æŸ¥è¯¢ä¸­åˆ é™¤-globalscopes" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢ä¸­åˆ é™¤-globalscopes" aria-hidden="true">#</a> æŸ¥è¯¢ä¸­åˆ é™¤ <code>globalScopes()</code></h2><p>ä½¿ç”¨æ¨¡å‹å…¨å±€ä½œç”¨åŸŸæ—¶ï¼Œä¸ä»…å¯ä»¥ä½¿ç”¨ MULTIPLE ä½œç”¨åŸŸï¼Œè¿˜å¯ä»¥åœ¨ä¸éœ€è¦æ—¶åˆ é™¤æŸäº›scopeï¼Œæ–¹æ³•æ˜¯å°†æ•°ç»„æä¾›ç»™ <code>withoutGlobalScopes()</code>ï¼š</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// åˆ é™¤æ‰€æœ‰å…¨å±€èŒƒå›´</span>
<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">withoutGlobalScopes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åˆ é™¤ä¸€äº›å…¨å±€èŒƒå›´</span>
<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">withoutGlobalScopes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token class-name static-context">FirstScope</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name static-context">SecondScope</span><span class="token operator">::</span><span class="token keyword">class</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="æŒ‰-json-å­—æ®µå€¼æ’åº-mysql" tabindex="-1"><a class="header-anchor" href="#æŒ‰-json-å­—æ®µå€¼æ’åº-mysql" aria-hidden="true">#</a> æŒ‰ JSON å­—æ®µå€¼æ’åºï¼ˆMySQLï¼‰</h2><p>åœ¨ Laravel å¼€å‘ä¸­ä½¿ç”¨<code>json</code> ç±»å‹å­—æ®µå­˜å‚¨å¤šä¸ªå€¼ï¼Œå¾ˆå¿«å°±é‡åˆ°äº†å¦‚ä½•ä½¿ç”¨ JSON å±æ€§å­—æ®µå¯¹æ•°æ®è¿›è¡Œæ’åºçš„é—®é¢˜ã€‚</p><p>ç”±äº JSON å±æ€§ä¸­çš„æ•°æ®è¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ•°æ®ï¼Œå› æ­¤åœ¨ eloquent orderBy æ–¹æ³•ä¸­æ‰§è¡Œ <code>json_field-&gt;property</code> çš„å¸¸ç”¨æ–¹æ³•æ²¡æœ‰ç»™å‡ºæ­£ç¡®çš„ç»“æœã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥æ’åºæˆ‘ä»¬çš„ç»“æœä¹‹å‰ï¼Œå¿…é¡»å°†å­—æ®µå±æ€§è½¬æ¢ä¸ºé€‚å½“çš„æ•°æ®ç±»å‹ï¼Œå°±æˆ‘è€Œè¨€ï¼Œæˆ‘æƒ³å°†å…¶è½¬æ¢ä¸ºæ— ç¬¦å·æ•´æ•°ã€‚</p><p>Eloquent æ¨¡å‹ä¸Šçš„ <code>$casts</code> å±æ€§ä¸é€‚ç”¨äº JSON å±æ€§ï¼Œå½“å‰æ‰¾åˆ°çš„å”¯ä¸€æ–¹æ³•æ˜¯ä½¿ç”¨ <code>orderByRaw</code>ã€‚</p><ul><li>æ•°æ®æ’åº</li></ul><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">orderByRaw</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;CAST(extra-&gt;&quot;$.popular_order_number&quot; AS unsigned) ASC&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>æ•°æ®æŸ¥è¯¢</li></ul><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">whereJsonContains</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;extra-&gt;is_popular&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>å‚è€ƒåœ°å€ï¼š<a href="https://5balloons.info/sort-by-mysql-json-field-value-in-laravel/" target="_blank" rel="noopener noreferrer">Sort by Mysql JSON Field Value in Laravel<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><h2 id="ä»ç¬¬ä¸€ä¸ªç»“æœä¸­è·å–å•åˆ—çš„å€¼-value" tabindex="-1"><a class="header-anchor" href="#ä»ç¬¬ä¸€ä¸ªç»“æœä¸­è·å–å•åˆ—çš„å€¼-value" aria-hidden="true">#</a> ä»ç¬¬ä¸€ä¸ªç»“æœä¸­è·å–å•åˆ—çš„å€¼ <code>value()</code></h2><p>å¯ä»¥ä½¿ç”¨ <code>value()</code> æ–¹æ³•ä»æŸ¥è¯¢çš„ç¬¬ä¸€ä¸ªç»“æœä¸­è·å–å•ä¸ªåˆ—çš„å€¼</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// Instead of</span>
<span class="token class-name static-context">Integration</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;foo&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">active</span><span class="token punctuation">;</span>

<span class="token comment">// You can use</span>
<span class="token class-name static-context">Integration</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;foo&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;active&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// or this to throw an exception if no records found</span>
<span class="token class-name static-context">Integration</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;foo&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">valueOrFail</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;active&#39;</span><span class="token punctuation">)</span>&#39;<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="æ£€æŸ¥æ›´æ”¹çš„å€¼æ˜¯å¦æ›´æ”¹" tabindex="-1"><a class="header-anchor" href="#æ£€æŸ¥æ›´æ”¹çš„å€¼æ˜¯å¦æ›´æ”¹" aria-hidden="true">#</a> æ£€æŸ¥æ›´æ”¹çš„å€¼æ˜¯å¦æ›´æ”¹</h2><p>æƒ³çŸ¥é“å¯¹æ¨¡å‹æ‰€åšçš„æ›´æ”¹æ˜¯å¦æ”¹å˜äº†é”®çš„å€¼ï¼Œä½¿ç”¨ <code>originalIsEquivalent</code>ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&#39;name&#39; =&gt; &quot;John&#39;]</span>

<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;John&#39;</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">originalIsEquivalent</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;David&#39;</span><span class="token punctuation">;</span> <span class="token comment">// Set directly</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;name&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;David&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Or set via fill</span>

<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">originalIsEquivalent</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="å®šä¹‰è®¿é—®å™¨å’Œä¿®æ”¹å™¨çš„æ–°æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰è®¿é—®å™¨å’Œä¿®æ”¹å™¨çš„æ–°æ–¹æ³•" aria-hidden="true">#</a> å®šä¹‰è®¿é—®å™¨å’Œä¿®æ”¹å™¨çš„æ–°æ–¹æ³•</h2><p>åœ¨ Laravel 8.77 ä¸­å®šä¹‰å±æ€§è®¿é—®å™¨å’Œä¿®æ”¹å™¨çš„æ–°æ–¹æ³•ï¼š</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// Before, two-method approach</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">setTitleAttribute</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">attributes</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;title&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getTitleAttribute</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">strtoupper</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token comment">// New approach</span>
<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Attribute</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Attribute</span><span class="token punctuation">(</span>
        <span class="token argument-name">get</span><span class="token punctuation">:</span> <span class="token keyword">fn</span> <span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">strtoupper</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token argument-name">set</span><span class="token punctuation">:</span> <span class="token keyword">fn</span> <span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="ä¿å­˜æ¨¡å‹åŠå…¶æ‰€æœ‰å…³ç³»" tabindex="-1"><a class="header-anchor" href="#ä¿å­˜æ¨¡å‹åŠå…¶æ‰€æœ‰å…³ç³»" aria-hidden="true">#</a> ä¿å­˜æ¨¡å‹åŠå…¶æ‰€æœ‰å…³ç³»</h2><p>ä½¿ç”¨ <code>push()</code> æ–¹æ³•æ›´æ–°æ•°æ®åº“ä¸­çš„ä¸»æ¨¡å‹å’Œç›¸å…³æ¨¡å‹ã€‚</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token doc-comment comment">/**
 * ä½¿ç”¨ `push()` å°†ä¸»æ¨¡å‹ä¸ä»»ä½•æ›´æ”¹å…³ç³»ä¸€èµ·ä¿å­˜
 */</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">phone</span><span class="token punctuation">(</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">has0ne</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;App\Models\Phone&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;John&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">phone</span><span class="token operator">-&gt;</span><span class="token property">number</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;1234567890&#39;</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™ä¼šæ›´æ–°æ•°æ®åº“ä¸­çš„ç”¨æˆ·è®°å½•å’Œç›¸å…³çš„ç”¨æˆ·ç”µè¯å·ç è®°å½•</span>
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line">Â </div></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="è·å–æŸ¥è¯¢æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#è·å–æŸ¥è¯¢æ—¥å¿—" aria-hidden="true">#</a> è·å–æŸ¥è¯¢æ—¥å¿—</h2><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­è®°å½•æ‰€æœ‰æ•°æ®åº“æŸ¥è¯¢ï¼Œè¯·å°†æ­¤ä»£ç æ®µæ·»åŠ åˆ°çš„ <code>AppServiceProvider.php</code>ï¼š</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name static-context">App</span><span class="token operator">::</span><span class="token function">environment</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;local&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">logger</span><span class="token punctuation">(</span><span class="token class-name static-context">Str</span><span class="token operator">::</span><span class="token function">replaceArray</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;?&#39;</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token property">bindings</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token property">sql</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: q.curder@gmail.com">curder</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/laravel-study/partials/blade.html" class="" aria-label="Blade æ¨¡ç‰ˆ"><!--[--><!--]--> Blade æ¨¡ç‰ˆ <!--[--><!--]--></a></span><span class="next"><a href="/laravel-study/partials/routing.html" class="" aria-label="Routing è·¯ç”±"><!--[--><!--]--> Routing è·¯ç”± <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/laravel-study/assets/app.3ee12f16.js" defer></script>
  </body>
</html>
